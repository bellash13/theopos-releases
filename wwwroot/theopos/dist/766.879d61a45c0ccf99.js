"use strict";(self.webpackChunktheopos=self.webpackChunktheopos||[]).push([[766],{2766:(ht,P,u)=>{u.r(P),u.d(P,{PosModule:()=>gt});var q=u(6315),v=u(9808),C=u(8505),y=u(1566),O=u(4482),L=u(5403),U=u(1884),I=u(3900),w=u(262),k=u(9646);const x_setFocus=function J(r,i=0){!r||setTimeout(()=>{r.nativeElement.focus()},i)},x_removeFocus=function Q(r,i=0){!r||setTimeout(()=>{r.nativeElement.blur()},i)};var g=u(2291),l=u(2382),N=u(5439),f=u(3194),t=u(1223),E=u(2290),T=u(5425);let M=(()=>{class r{transform(e,...o){return e}}return r.\u0275fac=function(e){return new(e||r)},r.\u0275pipe=t.Yjl({name:"toFormControl",type:r,pure:!0}),r})(),Y=(()=>{class r{transform(e,...o){return e}}return r.\u0275fac=function(e){return new(e||r)},r.\u0275pipe=t.Yjl({name:"formArray",type:r,pure:!0}),r})();const D=["invoiceDialog"],V=["productIdCtrl"],H=["quantityCtrl"],j=function(r){return{"bg-gray":r}};function R(r,i){if(1&r){const e=t.EpF();t.TgZ(0,"tr",14)(1,"td",15),t._uU(2),t.qZA(),t.TgZ(3,"td",12),t._uU(4),t.qZA(),t.TgZ(5,"td",16)(6,"button",17),t.NdJ("click",function(){const s=t.CHM(e).$implicit;return t.oxw(2).selectProduct(s)}),t._uU(7," + Ajouter "),t.qZA()()()}if(2&r){const e=i.$implicit,o=t.oxw(2);t.Q6J("ngClass",t.VKq(3,j,o.selectedProduct&&e.productId==o.selectedProduct.productId)),t.xp6(2),t.Oqu(e.name),t.xp6(2),t.Oqu(e.priceSell)}}function z(r,i){if(1&r&&(t.ynx(0),t.TgZ(1,"table",9)(2,"tr",10)(3,"th",11),t._uU(4,"Produit"),t.qZA(),t.TgZ(5,"th",12),t._uU(6,"Prix"),t.qZA(),t._UZ(7,"th"),t.qZA(),t.YNc(8,R,8,5,"tr",13),t.qZA(),t.BQk()),2&r){const e=t.oxw();t.xp6(8),t.Q6J("ngForOf",e.products)}}const B=function(r){return{"border-info":r}};function $(r,i){if(1&r){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",19)(2,"div",20),t._UZ(3,"img",21),t.TgZ(4,"div",22)(5,"h6",23),t._uU(6),t.qZA(),t.TgZ(7,"p",24)(8,"button",25),t.NdJ("click",function(){const s=t.CHM(e).$implicit;return t.oxw(2).selectProduct(s)}),t._UZ(9,"i",26),t._uU(10," Ajouter"),t.qZA()()()()(),t.BQk()}if(2&r){const e=i.$implicit,o=t.oxw(2);t.xp6(2),t.Q6J("ngClass",t.VKq(2,B,o.selectedProduct&&e.productId==o.selectedProduct.productId)),t.xp6(4),t.Oqu(e.name)}}function G(r,i){if(1&r&&(t.ynx(0),t.TgZ(1,"div",0),t.YNc(2,$,11,4,"ng-container",18),t.qZA(),t.BQk()),2&r){const e=t.oxw();t.xp6(2),t.Q6J("ngForOf",e.products)}}function K(r,i){if(1&r&&(t.TgZ(0,"option",53),t.ALo(1,"toFormControl"),t._uU(2),t.qZA()),2&r){const e=i.$implicit,o=t.oxw(2);let n;t.Q6J("value",e.customerId)("selected",e.customerId==(null==(n=t.lcZ(1,3,o.orderForm.get("idCustomer")))?null:n.value)),t.xp6(2),t.hij(" ",e.name,"")}}function W(r,i){if(1&r){const e=t.EpF();t.TgZ(0,"button",54),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(2),s=t.MAs(12);return n.open(s)}),t._UZ(1,"i",55),t.qZA()}}function X(r,i){1&r&&(t.TgZ(0,"div")(1,"em"),t._uU(2,"Recherche en cours..."),t.qZA()())}function tt(r,i){if(1&r){const e=t.EpF();t.TgZ(0,"div")(1,"input",56,57),t.NdJ("selectItem",function(n){return t.CHM(e),t.oxw(2).selectProduct(n.item)}),t.qZA(),t.YNc(3,X,3,0,"div",5),t.qZA()}if(2&r){const e=t.oxw(2),o=t.MAs(14);t.xp6(1),t.ekj("is-invalid",e.productSearchFailed),t.Q6J("ngbTypeahead",e.productSearch)("resultTemplate",o)("inputFormatter",e.productFormatter),t.xp6(2),t.Q6J("ngIf",e.productSearching)}}function et(r,i){if(1&r&&(t.TgZ(0,"span",62),t._uU(1),t.qZA()),2&r){const e=t.oxw(3);t.s9C("title",e.selectedProduct.description),t.xp6(1),t.Oqu(e.selectedProduct.name)}}function rt(r,i){if(1&r){const e=t.EpF();t.TgZ(0,"div",58)(1,"button",59),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).unselectProduct()}),t._UZ(2,"i",60),t._uU(3," Changer"),t.qZA(),t.YNc(4,et,2,2,"span",61),t.qZA()}if(2&r){const e=t.oxw(2);t.xp6(4),t.Q6J("ngIf",e.selectedProduct.name)}}function ot(r,i){if(1&r){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",63)(2,"div",40)(3,"div",38),t._UZ(4,"input",64),t.ALo(5,"toFormControl"),t._UZ(6,"input",65),t.ALo(7,"toFormControl"),t.qZA()(),t.TgZ(8,"div",66)(9,"div",38)(10,"input",67,68),t.NdJ("keyup.enter",function(){return t.CHM(e),t.oxw(2).insertLine()})("keyup.escape",function(){return t.CHM(e),t.oxw(2).unselectProduct()}),t.ALo(12,"toFormControl"),t.qZA()()(),t.TgZ(13,"div",69)(14,"div",38)(15,"strong"),t._uU(16),t.ALo(17,"toFormControl"),t.qZA()()(),t.TgZ(18,"div",66)(19,"div",38)(20,"button",70),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).insertLine()})("keyup.enter",function(){return t.CHM(e),t.oxw(2).insertLine()}),t._uU(21,"Ins\xe9rer"),t.qZA()()()(),t.BQk()}if(2&r){const e=t.oxw(2);t.xp6(1),t.Q6J("formGroup",e.currentLineForm),t.xp6(3),t.Q6J("formControl",t.lcZ(5,8,e.currentLineForm.get("idProduct")))("readOnly",!0),t.xp6(2),t.Q6J("formControl",t.lcZ(7,10,e.currentLineForm.get("price")))("readOnly",!0),t.xp6(4),t.Q6J("formControl",t.lcZ(12,12,e.currentLineForm.get("quantity"))),t.xp6(6),t.Oqu(t.lcZ(17,14,e.currentLineForm.get("total")).value),t.xp6(4),t.Q6J("disabled",e.currentLineForm.invalid)}}function nt(r,i){if(1&r){const e=t.EpF();t.TgZ(0,"tr",45)(1,"td",46),t._uU(2),t.qZA(),t.TgZ(3,"td",47),t._uU(4),t.ALo(5,"number"),t.qZA(),t.TgZ(6,"td",47),t._uU(7),t.ALo(8,"number"),t.qZA(),t.TgZ(9,"td",47),t._uU(10),t.ALo(11,"number"),t.qZA(),t.TgZ(12,"td")(13,"button",71),t.NdJ("click",function(){const s=t.CHM(e).$implicit;return t.oxw(2).removeLine(s.value)}),t._uU(14,"x"),t.qZA()()()}if(2&r){const e=i.$implicit;let o,n,s,c;t.xp6(2),t.Oqu((null==(o=e.get("productDescription"))?null:o.value)||(null==(o=e.get("idProduct"))?null:o.value)),t.xp6(2),t.Oqu(t.lcZ(5,4,null==(n=e.get("price"))?null:n.value)),t.xp6(3),t.Oqu(t.lcZ(8,6,null==(s=e.get("quantity"))?null:s.value)),t.xp6(3),t.Oqu(t.lcZ(11,8,null==(c=e.get("total"))?null:c.value))}}function it(r,i){if(1&r){const e=t.EpF();t.TgZ(0,"tr",45)(1,"td",72)(2,"div",73)(3,"ngb-pagination",74),t.NdJ("pageChange",function(n){return t.CHM(e),t.oxw(2).orderPage=n}),t.ALo(4,"formArray"),t.qZA()()()()}if(2&r){const e=t.oxw(2);t.xp6(3),t.Q6J("page",e.orderPage)("pageSize",e.orderPageSize)("collectionSize",t.lcZ(4,3,e.orderForm.get("invoiceLines")).controls.length)}}function st(r,i){if(1&r){const e=t.EpF();t.TgZ(0,"div",75)(1,"div",0)(2,"div",76)(3,"button",77),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).cancel()}),t._uU(4,"Annuler"),t.qZA()(),t.TgZ(5,"div",78)(6,"button",79),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).save()}),t._uU(7,"Payer"),t.qZA()()()()}}function lt(r,i){if(1&r&&(t.ynx(0),t.TgZ(1,"form",27)(2,"div",28)(3,"div",29)(4,"div",19)(5,"div",30)(6,"label",31),t._uU(7,"Client:"),t.qZA(),t.TgZ(8,"select",32),t.ALo(9,"toFormControl"),t._UZ(10,"option",33),t.YNc(11,K,3,5,"option",34),t.qZA()()(),t.TgZ(12,"div",35),t.YNc(13,W,2,0,"button",36),t.qZA(),t.TgZ(14,"div",37)(15,"div",38)(16,"label",31),t._uU(17,"Date:"),t.qZA(),t._uU(18),t.ALo(19,"date"),t.ALo(20,"toFormControl"),t.qZA(),t.TgZ(21,"div",38)(22,"label",31),t._uU(23,"Taux du jour:"),t.qZA(),t._uU(24),t.ALo(25,"number"),t.ALo(26,"toFormControl"),t.qZA(),t.TgZ(27,"div",38)(28,"label",31),t._uU(29,"D\xe9vise:"),t.qZA(),t._uU(30),t.ALo(31,"toFormControl"),t.qZA()()()(),t.TgZ(32,"div",39)(33,"div",0)(34,"div",40),t.YNc(35,tt,4,6,"div",5),t.YNc(36,rt,5,1,"div",41),t.qZA(),t.TgZ(37,"div",42),t.YNc(38,ot,22,16,"ng-container",5),t.qZA()()(),t.TgZ(39,"div",43)(40,"div",3)(41,"table",44)(42,"tr",45)(43,"th",46),t._uU(44,"Produit"),t.qZA(),t.TgZ(45,"th",47),t._uU(46,"Prix"),t.qZA(),t.TgZ(47,"th",47),t._uU(48,"Quantit\xe9"),t.qZA(),t.TgZ(49,"th",47),t._uU(50,"Total"),t.qZA(),t._UZ(51,"th"),t.qZA(),t.YNc(52,nt,15,10,"tr",48),t.ALo(53,"slice"),t.ALo(54,"formArray"),t.YNc(55,it,5,5,"tr",49),t.ALo(56,"formArray"),t.TgZ(57,"tr",45)(58,"td",50),t._uU(59,"TVA"),t.qZA(),t.TgZ(60,"th",47),t._uU(61),t.ALo(62,"number"),t.qZA(),t._UZ(63,"th"),t.qZA(),t.TgZ(64,"tr",45)(65,"td",51),t._uU(66,"Total \xe0 payer"),t.qZA(),t.TgZ(67,"th",47),t._uU(68),t.ALo(69,"number"),t.ALo(70,"toFormControl"),t.TgZ(71,"strong"),t._uU(72),t.ALo(73,"toFormControl"),t.qZA()(),t._UZ(74,"th"),t.qZA()(),t.YNc(75,st,8,0,"div",52),t.ALo(76,"formArray"),t.qZA()()(),t.BQk()),2&r){const e=t.oxw();let o,n,s,c,a;t.xp6(1),t.Q6J("formGroup",e.orderForm),t.xp6(7),t.Q6J("formControl",t.lcZ(9,16,e.orderForm.get("idCustomer"))),t.xp6(3),t.Q6J("ngForOf",e.customers),t.xp6(2),t.Q6J("ngIf",e.newInvoice),t.xp6(5),t.hij(" ",t.xi3(19,18,null==(o=t.lcZ(20,21,e.orderForm.get("invoiceDate")))?null:o.value,"dd/MM/yyyy")," "),t.xp6(6),t.hij(" ",t.lcZ(25,23,null==(n=t.lcZ(26,25,e.orderForm.get("rate")))?null:n.value)," "),t.xp6(6),t.hij(" ",null==(s=t.lcZ(31,27,e.orderForm.get("idCurrency")))?null:s.value," "),t.xp6(5),t.Q6J("ngIf",!e.selectedProduct),t.xp6(1),t.Q6J("ngIf",e.selectedProduct),t.xp6(2),t.Q6J("ngIf",e.currentLineForm),t.xp6(14),t.Q6J("ngForOf",t.Dn7(53,29,t.lcZ(54,33,e.orderForm.get("invoiceLines")).controls,(e.orderPage-1)*e.orderPageSize,e.orderPage*e.orderPageSize)),t.xp6(3),t.Q6J("ngIf",t.lcZ(56,35,e.orderForm.get("invoiceLines")).controls.length>e.orderPageSize),t.xp6(6),t.hij("% ",t.lcZ(62,37,"16"),""),t.xp6(7),t.hij("",t.lcZ(69,39,null==(c=t.lcZ(70,41,e.orderForm.get("total")))?null:c.value)," "),t.xp6(4),t.Oqu(null==(a=t.lcZ(73,43,e.orderForm.get("idCurrency")))?null:a.value),t.xp6(3),t.Q6J("ngIf",t.lcZ(76,45,e.orderForm.get("invoiceLines")).controls.length)}}const F=function(r){return{"bg-success text-white":r}};function ct(r,i){if(1&r&&(t.ynx(0),t.TgZ(1,"tr")(2,"td"),t._uU(3),t.qZA(),t.TgZ(4,"td",47),t._uU(5),t.qZA(),t.TgZ(6,"td",47),t._uU(7),t.qZA(),t.TgZ(8,"td",89),t._uU(9),t.qZA()(),t.BQk()),2&r){const e=i.$implicit;t.xp6(3),t.Oqu(null==e.product?null:e.product.name),t.xp6(2),t.Oqu(e.qtyPurchase),t.xp6(2),t.Oqu(e.qtyReceived),t.xp6(1),t.Q6J("ngClass",t.VKq(5,F,e.qtyPurchase===e.qtyReceived)),t.xp6(1),t.Oqu((e.qtyPurchase||0)-(e.qtyReceived||0))}}function ut(r,i){if(1&r&&(t.ynx(0),t.TgZ(1,"tr")(2,"td"),t._uU(3,"Article"),t.qZA(),t.TgZ(4,"td",47),t._uU(5,"Qt\xe9 command\xe9e"),t.qZA(),t.TgZ(6,"td",47),t._uU(7,"Qt\xe9 livr\xe9e"),t.qZA(),t.TgZ(8,"td",47),t._uU(9,"Qt\xe9 restante"),t.qZA()(),t.YNc(10,ct,10,7,"ng-container",18),t.BQk()),2&r){const e=i.$implicit;t.xp6(10),t.Q6J("ngForOf",e.goodsIssueLines)}}function dt(r,i){if(1&r&&(t.TgZ(0,"div")(1,"div",86)(2,"dl",0)(3,"dt",19),t._uU(4,"Date"),t.qZA(),t.TgZ(5,"dd",78),t._uU(6),t.ALo(7,"date"),t.qZA(),t.TgZ(8,"dt",19),t._uU(9,"Client"),t.qZA(),t.TgZ(10,"dd",78),t._uU(11),t.qZA(),t.TgZ(12,"dt",19),t._uU(13,"Total facture"),t.qZA(),t.TgZ(14,"dd",78),t._uU(15),t.ALo(16,"number"),t.qZA(),t.TgZ(17,"dt",19),t._uU(18,"Montant pay\xe9"),t.qZA(),t.TgZ(19,"dd",87),t._uU(20),t.ALo(21,"number"),t.TgZ(22,"strong"),t._uU(23),t.qZA()()()(),t.TgZ(24,"div",86)(25,"table",88),t.YNc(26,ut,11,1,"ng-container",18),t.qZA()()()),2&r){const e=t.oxw(2);t.xp6(6),t.Oqu(t.lcZ(7,8,null==e.newInvoice||null==e.newInvoice.invoiceDate?null:e.newInvoice.invoiceDate.toDate())),t.xp6(5),t.Oqu(null==e.newInvoice.customer?null:e.newInvoice.customer.name),t.xp6(4),t.AsE("",t.lcZ(16,10,null==e.newInvoice?null:e.newInvoice.total)," ",e.newInvoice.idCurrency,""),t.xp6(4),t.Q6J("ngClass",t.VKq(14,F,(null==e.newInvoice?null:e.newInvoice.total)===(null==e.newInvoice?null:e.newInvoice.totalPaid))),t.xp6(1),t.hij(" ",t.lcZ(21,12,null==e.newInvoice?null:e.newInvoice.totalPaid)," "),t.xp6(3),t.Oqu(null==e.newInvoice?null:e.newInvoice.idCurrency),t.xp6(3),t.Q6J("ngForOf",e.newInvoice.goodsIssues)}}function at(r,i){if(1&r){const e=t.EpF();t.TgZ(0,"div",80)(1,"h4",81),t._uU(2,"Derni\xe8re facture"),t.qZA(),t.TgZ(3,"button",82),t.NdJ("click",function(){return t.CHM(e).$implicit.dismiss("Cross click")}),t.qZA()(),t.TgZ(4,"div",83),t.YNc(5,dt,27,16,"div",5),t.qZA(),t.TgZ(6,"div",84)(7,"button",85),t.NdJ("click",function(){return t.CHM(e).$implicit.close("Save click")}),t._uU(8,"Imprimer"),t.qZA()()}if(2&r){const e=t.oxw();t.xp6(5),t.Q6J("ngIf",e.newInvoice)}}function pt(r,i){if(1&r&&t._UZ(0,"ngb-highlight",90),2&r){const e=i.result,o=i.term;t.Q6J("result",e.productId+" "+e.name)("term",o)}}const _t=[{path:"",component:(()=>{class r{constructor(e,o,n,s,c,a){this.customersServ=e,this.productsServ=o,this.invoiceServ=n,this.fb=s,this.toastr=c,this.modalService=a,this.customers=[],this.products=[],this.productSearching=!1,this.productSearchFailed=!1,this.productView="grid",this.orderPage=1,this.orderPageSize=4,this.productSearch=d=>d.pipe(function S(r,i=y.z){return(0,O.e)((e,o)=>{let n=null,s=null,c=null;const a=()=>{if(n){n.unsubscribe(),n=null;const p=s;s=null,o.next(p)}};function d(){const p=c+r,_=i.now();if(_<p)return n=this.schedule(void 0,p-_),void o.add(n);a()}e.subscribe((0,L.x)(o,p=>{s=p,c=i.now(),n||(n=i.schedule(d,r),o.add(n))},()=>{a(),o.complete()},void 0,()=>{s=n=null}))})}(300),(0,U.x)(),(0,C.b)(()=>{this.productSearching=!0}),(0,I.w)(p=>this.productsServ.index(p,0,20).pipe((0,C.b)(_=>{this.productSearchFailed=!1,1===_.length&&this.selectProduct(_[0])}),(0,w.K)(()=>(this.productSearchFailed=!0,(0,k.of)([]))))),(0,C.b)(()=>{this.productSearching=!1})),this.productFormatter=d=>d.itemId}ngAfterViewInit(){this.setFocusForControls()}ngOnInit(){this.getCustomers()}buildForm(){this.getProducts(),this.currentInvoice||(this.currentInvoice=new g.DU({idCurrency:"CDF",idCustomer:this.customers.length?this.customers[0].customerId:""})),this.orderForm=this.fb.group({invoiceId:[this.currentInvoice.invoiceId,[]],idCustomer:[this.currentInvoice.idCustomer,[l.kI.required]],invoiceDate:[this.currentInvoice.invoiceDate||N.utc(new Date),[l.kI.required]],description:[this.currentInvoice.description,[]],rate:[2e3,[]],idCurrency:[this.currentInvoice.idCurrency,[]],total:[0,[]],invoiceLines:this.fb.array([])}),(this.currentInvoice.invoiceLines||[]).forEach(e=>{this.addLine(e,!1)}),this.setOrderTotal(),this.buildLineForm(new g.pk)}setOrderTotal(){var e;let o=0;(this.orderForm.get("invoiceLines").value||[]).forEach(n=>{o+=n.total||0}),null===(e=this.orderForm.get("total"))||void 0===e||e.setValue(o)}addLine(e,o=!0){var n,s,c,a,d;let p=!1;const _=this.orderForm.get("invoiceLines");if(_.controls.forEach(b=>{var A;const Z=b,vt=null===(A=null==Z?void 0:Z.get("idProduct"))||void 0===A?void 0:A.value;if(e.idProduct===vt){const h=Z.get("quantity"),ft=(null==h?void 0:h.value)+e.quantity;null==h||h.setValue(ft),Z.updateValueAndValidity(),p=!0}}),p)return o&&this.toastr.info(`Quantit\xe9 mise \xe0 jour pour ${e.idProduct}`),void this.unselectProduct();const m=this.fb.group({discount:[e.discount||0,[]],idProduct:[e.idProduct||"",[l.kI.required]],productDescription:[(null===(n=e.product)||void 0===n?void 0:n.name)||"",[]],idInvoice:[e.idInvoice||"",[]],price:[e.price||0,[l.kI.required,l.kI.min(0)]],quantity:[e.quantity||1,[l.kI.min(0)]],invoiceLineId:[e.invoiceLineId||"",[]],subTotal:[e.subTotal||0,[]],total:[e.total||0,[]]});this.setInvoiceLineTotal(m),null===(s=m.get("quantity"))||void 0===s||s.valueChanges.subscribe(b=>{this.setInvoiceLineTotal(m)}),null===(c=m.get("price"))||void 0===c||c.valueChanges.subscribe(b=>{this.setInvoiceLineTotal(m)}),null===(a=m.get("discount"))||void 0===a||a.valueChanges.subscribe(b=>{this.setInvoiceLineTotal(m)}),null===(d=m.get("total"))||void 0===d||d.valueChanges.subscribe(b=>{this.setOrderTotal()}),_.push(m),this.setOrderTotal(),o&&this.toastr.info("Article ajout\xe9 \xe0 liste avec succ\xe8s."),this.unselectProduct()}setInvoiceLineTotal(e){var o,n,s,c;const _=(null===(o=e.get("price"))||void 0===o?void 0:o.value)*(null===(n=e.get("quantity"))||void 0===n?void 0:n.value)-(null===(s=e.get("discount"))||void 0===s?void 0:s.value);null===(c=e.get("total"))||void 0===c||c.setValue(_)}getProducts(){this.productsServ.index().subscribe(e=>{this.products=e})}selectProduct(e){var o,n,s;const c=e.productId===(null===(n=null===(o=this.currentLineForm)||void 0===o?void 0:o.get("idProduct"))||void 0===n?void 0:n.value);if(this.selectedProduct=e,c){const d=null===(s=this.currentLineForm)||void 0===s?void 0:s.get("quantity"),p=((null==d?void 0:d.value)||0)+1;return null==d||d.setValue(p),void this.setFocusForControls()}const a=new g.pk({idProduct:this.selectedProduct.productId,price:this.selectedProduct.priceSell,quantity:1,product:new g.xs({name:this.selectedProduct.name})});this.buildLineForm(a)}buildLineForm(e){var o,n;this.currentLineForm=this.fb.group({idProduct:[e.idProduct||"",[l.kI.required]],product:this.fb.group({name:null===(o=null==e?void 0:e.product)||void 0===o?void 0:o.name}),discount:[e.discount||0,[]],price:[e.price||0,[l.kI.required,l.kI.min(0)]],quantity:[e.quantity||0,[l.kI.required,l.kI.min(0)]],total:[e.total||0,[l.kI.required,l.kI.min(0)]]}),null===(n=this.currentLineForm.get("quantity"))||void 0===n||n.valueChanges.subscribe(s=>{this.setInvoiceLineTotal(this.currentLineForm)}),this.setInvoiceLineTotal(this.currentLineForm),this.setFocusForControls()}setFocusForControls(){this.currentLineForm.value.idProduct?(x_removeFocus(this.productIdCtrl),x_setFocus(this.quantityCtrl)):(x_removeFocus(this.quantityCtrl),setTimeout(()=>{x_setFocus(this.productIdCtrl,1)},500))}insertLine(){var e;!this.currentLineForm||!this.isValidLine(null===(e=this.currentLineForm)||void 0===e?void 0:e.value)||this.addLine(this.currentLineForm.value)}isValidLine(e){return!(!e||((null==e?void 0:e.idProduct)?((null==e?void 0:e.quantity)||0)<=0?(this.toastr.error("Quantit\xe9 invalide."),1):((null==e?void 0:e.price)||0)<=0&&(this.toastr.error("Prix invalide."),1):(this.toastr.error("S\xe9lectionner un produit."),1)))}getCustomers(){this.customersServ.index().subscribe(e=>{this.customers=e,this.buildForm()},e=>{this.toastr.error("Aucun client disponible.")})}save(){this.orderForm.invalid?this.toastr.error("Formulaire invalide"):this.invoiceServ.create(this.orderForm.value).subscribe(e=>{this.toastr.success("Sauvegard\xe9e avec succ\xe8s."),this.newInvoice=e,this.open(this.invoiceDialog),this.buildForm()},e=>{this.toastr.error("Impossible de sauvegarder")})}cancel(){}pay(){}removeLine(e){var o;const n=this.orderForm.get("invoiceLines");for(var s=n.controls.length-1;s>=0;s--)e.idProduct&&(null===(o=n.controls[s].get("idProduct"))||void 0===o?void 0:o.value)===e.idProduct&&(n.controls.splice(s,1),s--)}open(e){this.modalService.open(e,{ariaLabelledBy:"modal-basic-title"}).result.then(o=>{},o=>{})}getDismissReason(e){return e===f.If.ESC?"by pressing ESC":e===f.If.BACKDROP_CLICK?"by clicking on a backdrop":`with: ${e}`}unselectProduct(){this.selectedProduct=null,this.buildLineForm(new g.pk)}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(g.Mu),t.Y36(g.b0),t.Y36(g.qA),t.Y36(l.qu),t.Y36(E._W),t.Y36(f.FF))},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-pos"]],viewQuery:function(e,o){if(1&e&&(t.Gf(D,5),t.Gf(V,5),t.Gf(H,5)),2&e){let n;t.iGM(n=t.CRH())&&(o.invoiceDialog=n.first),t.iGM(n=t.CRH())&&(o.productIdCtrl=n.first),t.iGM(n=t.CRH())&&(o.quantityCtrl=n.first)}},decls:15,vars:3,consts:[[1,"row"],[1,"col-md-4","mb-2"],[1,"card"],[1,"card-body"],[1,"mt-2","mb-4","text-center",3,"dblclick"],[4,"ngIf"],[1,"col-md-8","mb-2"],["invoiceDialog",""],["productResultTpl",""],[1,"table","table-striped","table-borderless"],[1,"bg-info","text-white"],[1,"ps-2","pt-2","pb-2"],[1,"text-end","pe-2"],["class","border border-start-0 border-end-0 ps-2 pt-2 pb-2",3,"ngClass",4,"ngFor","ngForOf"],[1,"border","border-start-0","border-end-0","ps-2","pt-2","pb-2",3,"ngClass"],[1,"ps-2","mt-4","mb-4"],[1,"text-end","pe-1"],["type","button",1,"btn","btn-sm","btn-outline-success","pt-1","pb-1",3,"click"],[4,"ngFor","ngForOf"],[1,"col-md-6"],[1,"card","border","mb-1",3,"ngClass"],["ng-src","images/logox300.png","alt","",1,"card-img-top"],[1,"card-body","text-center"],[1,"card-title"],[1,"card-text"],[1,"btn","btn-sm","btn-outline-success",3,"click"],[1,"fa","fa-cart"],[3,"formGroup"],[1,"card","card-body","mt-1","mb-1"],[1,"row","mt-1","mb-1"],[1,"form-group","form-group-inline"],["for","",1,"control-label"],["id","",1,"form-control","form-control-sm",3,"formControl"],["value",""],[3,"value","selected",4,"ngFor","ngForOf"],[1,"col-md-2"],["class","btn btn-sm btn-outline-primary","type","button",3,"click",4,"ngIf"],[1,"col-md-4","text-end"],[1,"form-group"],[1,"card","card-body"],[1,"col-md-4"],["style","font-weight: bold",4,"ngIf"],[1,"col-md-8"],[1,"card","mt-2","mb-2"],[1,"table","table-striped"],[1,"border","border-start-0","border-end-0"],[1,"pt-2","pb-2"],[1,"text-end"],["class","border border-start-0 border-end-0",4,"ngFor","ngForOf"],["class","border border-start-0 border-end-0",4,"ngIf"],["colspan","3",1,"pt-2","pb-2"],["colspan","3",1,"pt-2","pb-2","text-end"],["class","mt-2 mb-2",4,"ngIf"],[3,"value","selected"],["type","button",1,"btn","btn-sm","btn-outline-primary",3,"click"],["title","Derni\xe8re facture",1,"bx","bx-calendar"],["type","text","autofocus","","placeholder","Code ou nom du produit...","tabindex","1",1,"form-control","form-control-sm",3,"ngbTypeahead","resultTemplate","inputFormatter","selectItem"],["productIdCtrl",""],[2,"font-weight","bold"],["type","button","title","Changer",1,"btn","btn-sm","btn-outline-warning","me-2","p-1",3,"click"],[1,"i-Edit"],[3,"title",4,"ngIf"],[3,"title"],["ngClass","{disabled: !currentLine}",1,"row",3,"formGroup"],["type","hidden","placeholder","Produit",1,"form-control","form-control-sm","text-end",3,"formControl","readOnly"],["type","number","step","0.0001","placeholder","Prix",1,"form-control","form-control-sm","text-end",3,"formControl","readOnly"],[1,"col-md-3"],["type","number","step","1","placeholder","Quantit\xe9",1,"form-control","form-control-sm","text-end",3,"formControl","keyup.enter","keyup.escape"],["quantityCtrl",""],[1,"col-md-2","text-end"],["type","button",1,"btn","btn-sm","btn-outline-success",3,"disabled","click","keyup.enter"],["type","button",1,"btn","btn-sm","btn-outline-warning","pt-1","pb-1",3,"click"],["colspan","4",1,"pt-2","pb-2"],[1,"text-center"],[3,"page","pageSize","collectionSize","pageChange"],[1,"mt-2","mb-2"],[1,"col-md-6","text-left"],["type","button",1,"btn","btn-danger",3,"click"],[1,"col-md-6","text-end"],["type","button",1,"btn","btn-success",3,"click"],[1,"modal-header"],["id","modal-basic-title",1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"modal-footer"],["type","button",1,"btn","btn-sm","btn-outline-dark",3,"click"],[1,"card","card-body","mb-2"],[1,"col-md-6","text-end",3,"ngClass"],[1,"table","table-borderless"],[1,"text-end",3,"ngClass"],[3,"result","term"]],template:function(e,o){1&e&&(t._UZ(0,"router-outlet"),t.TgZ(1,"div",0)(2,"div",1)(3,"div",2)(4,"div",3)(5,"h4",4),t.NdJ("dblclick",function(){return o.productView="list"==o.productView?"grid":"list"}),t._uU(6,"PRODUITS RECENTS"),t.qZA(),t.YNc(7,z,9,1,"ng-container",5),t.YNc(8,G,3,1,"ng-container",5),t.qZA()()(),t.TgZ(9,"div",6),t.YNc(10,lt,77,47,"ng-container",5),t.qZA()(),t.YNc(11,at,9,1,"ng-template",null,7,t.W1O),t.YNc(13,pt,1,2,"ng-template",null,8,t.W1O)),2&e&&(t.xp6(7),t.Q6J("ngIf","list"==o.productView),t.xp6(1),t.Q6J("ngIf","grid"==o.productView),t.xp6(2),t.Q6J("ngIf",o.orderForm))},directives:[T.lC,v.O5,v.sg,v.mk,l._Y,l.JL,l.sg,l.EJ,l.JJ,l.oH,l.YN,l.Kr,f.dR,l.Fj,l.wV,f.N9,f._h],pipes:[M,v.uU,v.JJ,v.OU,Y],styles:[""]}),r})()}];let mt=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[[T.Bz.forChild(_t)],T.Bz]}),r})(),gt=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[[v.ez,mt,q.m]]}),r})()}}]);