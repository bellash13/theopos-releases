"use strict";(self.webpackChunktheopos=self.webpackChunktheopos||[]).push([[187],{6187:(q,b,l)=>{l.r(b),l.d(b,{JournalsModule:()=>rt});var h=l(9808),_=l(9150),d=l(2291),n=l(1223),p=l(2680);let J=(()=>{class o{constructor(t){this.journalsSession=t,this.viewMode="list",this.subs=[]}ngOnDestroy(){this.subs.forEach(t=>{t&&t.unsubscribe()})}ngOnInit(){}ngAfterViewInit(){this.sessionify()}sessionify(){const t=this.journalsSession.journal$.subscribe(e=>{this.currentJournal=e});this.subs.push(t)}}return o.\u0275fac=function(t){return new(t||o)(n.Y36(p.l))},o.\u0275cmp=n.Xpm({type:o,selectors:[["app-journals"]],decls:6,vars:0,consts:[["routerLink","/accounting/journals/list","routerLinkActive","active"],["routerLink","/accounting/journals/create","routerLinkActive","active"]],template:function(t,e){1&t&&(n._UZ(0,"router-outlet"),n.TgZ(1,"a",0),n._uU(2,"Tous les journaux"),n.qZA(),n._uU(3," |\n"),n.TgZ(4,"a",1),n._uU(5,"Cr\xe9er journal"),n.qZA())},dependencies:[_.lC,_.yS,_.Od]}),o})();var c=l(2382);function N(o,r){if(1&o&&(n.ynx(0),n._uU(1),n.BQk()),2&o){const t=n.oxw().$implicit;n.xp6(1),n.hij(" (",t.idAccount,") ")}}function w(o,r){1&o&&(n.ynx(0),n._UZ(1,"i",5),n.BQk())}const Y=function(o){return["/accounting","journals",o]},O=function(){return{exact:!1}};function D(o,r){if(1&o&&(n.ynx(0),n.TgZ(1,"a",4),n._uU(2),n.YNc(3,N,2,1,"ng-container",0),n.YNc(4,w,2,0,"ng-container",0),n.qZA(),n.BQk()),2&o){const t=r.$implicit,e=n.oxw(2);n.xp6(1),n.Q6J("routerLink",n.VKq(5,Y,t.journalId))("routerLinkActiveOptions",n.DdM(7,O)),n.xp6(1),n.hij(" ",t.name," "),n.xp6(1),n.Q6J("ngIf",t.idAccount),n.xp6(1),n.Q6J("ngIf",e.currentJournal&&e.currentJournal.journalId===t.journalId)}}function M(o,r){if(1&o&&(n.ynx(0),n.TgZ(1,"ul",2),n.YNc(2,D,5,8,"ng-container",3),n.qZA(),n.BQk()),2&o){const t=n.oxw();n.xp6(2),n.Q6J("ngForOf",t.journals)}}function B(o,r){if(1&o){const t=n.EpF();n.ynx(0),n.TgZ(1,"div",8)(2,"button",14),n.NdJ("click",function(){n.CHM(t);const i=n.oxw(2);return n.KtG(i.previous())}),n._UZ(3,"i",15),n._uU(4," Pr\xe9c\xe9dent"),n.qZA()(),n.BQk()}}function V(o,r){if(1&o){const t=n.EpF();n.ynx(0),n.TgZ(1,"div",8)(2,"button",14),n.NdJ("click",function(){n.CHM(t);const i=n.oxw(2);return n.KtG(i.next())}),n._uU(3,"Suivant "),n._UZ(4,"i",16),n.qZA()(),n.BQk()}}function K(o,r){if(1&o&&(n.ynx(0),n.TgZ(1,"div"),n._uU(2,"Compte associ\xe9: "),n.TgZ(3,"strong"),n._uU(4),n.qZA()(),n.BQk()),2&o){const t=n.oxw().$implicit;n.xp6(4),n.Oqu(t.idAccount)}}const $=function(o){return["/accounting","journals",o,"edit"]},P=function(o){return["/accounting","journals",o,"entries"]};function G(o,r){if(1&o&&(n.TgZ(0,"div",17)(1,"div",18)(2,"div",19)(3,"h4",20),n._uU(4),n.qZA(),n.TgZ(5,"div",21),n._uU(6),n.qZA(),n.YNc(7,K,5,1,"ng-container",0),n.TgZ(8,"a",22),n._uU(9,"Modifier"),n.qZA()(),n.TgZ(10,"div",23)(11,"a",24),n._uU(12,"Acc\xe9der"),n.qZA()()()()),2&o){const t=r.$implicit;n.xp6(4),n.Oqu(t.name),n.xp6(2),n.Oqu(t.description),n.xp6(1),n.Q6J("ngIf",t.idAccount),n.xp6(1),n.Q6J("routerLink",n.VKq(5,$,t.journalId)),n.xp6(3),n.Q6J("routerLink",n.VKq(7,P,t.journalId))}}function R(o,r){if(1&o){const t=n.EpF();n.ynx(0),n.TgZ(1,"h4"),n._uU(2,"Journaux comptables"),n.qZA(),n._UZ(3,"hr"),n.TgZ(4,"div",6)(5,"div",7)(6,"div",8)(7,"input",9),n.NdJ("ngModelChange",function(i){n.CHM(t);const a=n.oxw();return n.KtG(a.term=i)}),n.qZA()(),n.TgZ(8,"div",8)(9,"button",10),n.NdJ("click",function(){n.CHM(t);const i=n.oxw();return n.KtG(i.search())}),n._UZ(10,"i",11),n._uU(11," Rechercher"),n.qZA()(),n.TgZ(12,"div",8)(13,"div",7),n.YNc(14,B,5,0,"ng-container",0),n.YNc(15,V,5,0,"ng-container",0),n.qZA()()()(),n.TgZ(16,"div",12),n.YNc(17,G,13,9,"div",13),n.qZA(),n.BQk()}if(2&o){const t=n.oxw();let e;n.xp6(7),n.Q6J("ngModel",t.term),n.xp6(7),n.Q6J("ngIf",t.index>0),n.xp6(1),n.Q6J("ngIf",(null!==(e=null==t.journals?null:t.journals.length)&&void 0!==e?e:0)>=t.pageSize),n.xp6(2),n.Q6J("ngForOf",t.journals)}}function H(o,r){if(1&o){const t=n.EpF();n.ynx(0),n.TgZ(1,"button",14),n.NdJ("click",function(){n.CHM(t);const i=n.oxw();return n.KtG(i.previous())}),n._UZ(2,"i",15),n._uU(3," Pr\xe9c\xe9dent"),n.qZA(),n.BQk()}}function z(o,r){if(1&o){const t=n.EpF();n.ynx(0),n.TgZ(1,"button",14),n.NdJ("click",function(){n.CHM(t);const i=n.oxw();return n.KtG(i.next())}),n._uU(2,"Suivant "),n._UZ(3,"i",16),n.qZA(),n.BQk()}}let U=(()=>{class o{constructor(t,e){this.journalsSession=t,this.journalsServ=e,this.viewMode="grid",this.journals=[],this.subs=[],this.pageSize=10,this.index=0}ngOnInit(){this.sessionify(),this.loadJournals()}ngOnDestroy(){this.subs.forEach(t=>{t&&t.unsubscribe()})}sessionify(){const t=this.journalsSession.journal$.subscribe(e=>{this.currentJournal=e});this.subs.push(t)}loadJournals(){const t=this.journalsServ.index(this.term,this.index,this.pageSize,this.template).subscribe(e=>{this.journals=e});this.subs.push(t)}next(){this.index=this.index+1,this.loadJournals()}previous(){this.index=this.index>0?this.index-1:0,this.loadJournals()}search(){this.index=0,this.loadJournals()}}return o.\u0275fac=function(t){return new(t||o)(n.Y36(p.l),n.Y36(d.yJ))},o.\u0275cmp=n.Xpm({type:o,selectors:[["app-journal-list"]],inputs:{viewMode:"viewMode"},decls:6,vars:4,consts:[[4,"ngIf"],[1,"p-2","my-2"],[1,"list-group"],[4,"ngFor","ngForOf"],["routerLinkActive","active",1,"list-group-item","list-group-item-action",3,"routerLink","routerLinkActiveOptions"],[1,"fa","fa-check"],[1,"card","card-body","my-2"],[1,"row"],[1,"col"],["type","text",1,"form-control",3,"ngModel","ngModelChange"],["type","button",1,"btn","btn-info",3,"click"],[1,"fa","fa-search"],[1,"row","row-cols-1","row-cols-sm-2","row-cols-md-3","row-cols-lg-4","g-2"],["class","col mb-2",4,"ngFor","ngForOf"],["type","button",1,"btn","btn-sm","btn-light","me-2",3,"click"],[1,"fa","fa-arrow-left"],[1,"fa","fa-arrow-right"],[1,"col","mb-2"],[1,"card","h-100"],[1,"card-body"],[1,"card-title"],[1,"alert","alert-secondary"],[3,"routerLink"],[1,"card-footer"],[1,"btn","btn-info",3,"routerLink"]],template:function(t,e){if(1&t&&(n.YNc(0,M,3,1,"ng-container",0),n.YNc(1,R,18,4,"ng-container",0),n.TgZ(2,"div",1)(3,"div"),n.YNc(4,H,4,0,"ng-container",0),n.YNc(5,z,4,0,"ng-container",0),n.qZA()()),2&t){let i;n.Q6J("ngIf","list"===e.viewMode),n.xp6(1),n.Q6J("ngIf","grid"===e.viewMode),n.xp6(3),n.Q6J("ngIf",e.index>0),n.xp6(1),n.Q6J("ngIf",(null!==(i=null==e.journals?null:e.journals.length)&&void 0!==i?i:0)>=e.pageSize)}},dependencies:[h.sg,h.O5,_.yS,_.Od,c.Fj,c.JJ,c.On]}),o})();const X=function(o){return["/accounting","journals",o,"transaction-edit"]},W=function(o){return["/accounting","journals",o,"entries"]},nn=function(o){return["/accounting","journals",o,"overview"]},tn=function(o){return["/accounting","journals",o,"edit"]},on=function(o){return["/accounting","journals",o,"delete"]};let en=(()=>{class o{constructor(t,e){this.route=t,this.journalsSession=e,this.subs=[]}ngOnInit(){this.sessionify(),this.querify()}ngOnDestroy(){this.subs.forEach(t=>{t&&t.unsubscribe()})}sessionify(){const t=this.journalsSession.journal$.subscribe(e=>{this.journal=e});this.subs.push(t)}querify(){const t=this.route.paramMap.subscribe(e=>{const i=e.get("id")||0;this.journalsSession.loadJournal(+i)});this.subs.push(t)}}return o.\u0275fac=function(t){return new(t||o)(n.Y36(_.gz),n.Y36(p.l))},o.\u0275cmp=n.Xpm({type:o,selectors:[["app-journal-details"]],decls:28,vars:15,consts:[[1,"mt-1","mb-1"],[1,"row"],[1,"col-md-3"],["viewMode","list"],[1,"col-md-9"],[1,"nav","nav-tabs"],[1,"nav-item"],["routerLinkActive","active",1,"nav-link",3,"routerLink"],["aria-hidden","true",1,"fa","fa-plus"],["aria-hidden","true",1,"fa","fa-database"],["aria-hidden","true",1,"fa","fa-eye"],["aria-hidden","true",1,"fa","fa-pencil"],["routerLinkActive","active",1,"nav-link","text-danger",3,"routerLink"],["aria-hidden","true",1,"fa","fa-trash"],[1,"mt-4","mb-4"]],template:function(t,e){1&t&&(n.TgZ(0,"div",0)(1,"div",1)(2,"div",2),n._UZ(3,"app-journal-list",3),n.qZA(),n.TgZ(4,"div",4)(5,"ul",5)(6,"li",6)(7,"a",7),n._UZ(8,"i",8),n._uU(9," Saisie "),n.qZA()(),n.TgZ(10,"li",6)(11,"a",7),n._UZ(12,"i",9),n._uU(13," Donn\xe9es "),n.qZA()(),n.TgZ(14,"li",6)(15,"a",7),n._UZ(16,"i",10),n._uU(17," Aper\xe7ue "),n.qZA()(),n.TgZ(18,"li",6)(19,"a",7),n._UZ(20,"i",11),n._uU(21," Modifier "),n.qZA()(),n.TgZ(22,"li",6)(23,"a",12),n._UZ(24,"i",13),n._uU(25," Supprimer "),n.qZA()()(),n.TgZ(26,"div",14),n._UZ(27,"router-outlet"),n.qZA()()()()),2&t&&(n.xp6(7),n.Q6J("routerLink",n.VKq(5,X,null==e.journal?null:e.journal.journalId)),n.xp6(4),n.Q6J("routerLink",n.VKq(7,W,null==e.journal?null:e.journal.journalId)),n.xp6(4),n.Q6J("routerLink",n.VKq(9,nn,null==e.journal?null:e.journal.journalId)),n.xp6(4),n.Q6J("routerLink",n.VKq(11,tn,null==e.journal?null:e.journal.journalId)),n.xp6(4),n.Q6J("routerLink",n.VKq(13,on,null==e.journal?null:e.journal.journalId)))},dependencies:[_.lC,_.yS,_.Od,U]}),o})();var T=l(8372),A=l(2290);function rn(o,r){if(1&o&&(n.ynx(0),n._uU(1),n.BQk()),2&o){const t=n.oxw();n.xp6(1),n.Oqu(t.journal.name)}}function an(o,r){1&o&&(n.TgZ(0,"small"),n._uU(1,"Nom est requis."),n.qZA())}function sn(o,r){1&o&&(n.TgZ(0,"small"),n._uU(1,"Nom ne peut pas d\xe9passer 30 caract\xe8res."),n.qZA())}function cn(o,r){if(1&o&&(n.TgZ(0,"div",13),n.YNc(1,an,2,0,"small",0),n.YNc(2,sn,2,0,"small",0),n.qZA()),2&o){const t=n.oxw(2);let e,i;n.xp6(1),n.Q6J("ngIf",null==(e=t.journalForm.get("name"))||null==e.errors?null:e.errors.required),n.xp6(1),n.Q6J("ngIf",null==(i=t.journalForm.get("name"))||null==i.errors?null:i.errors.maxlength)}}function un(o,r){1&o&&(n.TgZ(0,"small"),n._uU(1,"Description est requise."),n.qZA())}function ln(o,r){1&o&&(n.TgZ(0,"small"),n._uU(1,"Description ne peut pas d\xe9passer 255 caract\xe8res."),n.qZA())}function dn(o,r){if(1&o&&(n.TgZ(0,"div",13),n.YNc(1,un,2,0,"small",0),n.YNc(2,ln,2,0,"small",0),n.qZA()),2&o){const t=n.oxw(2);let e,i;n.xp6(1),n.Q6J("ngIf",null==(e=t.journalForm.get("description"))||null==e.errors?null:e.errors.required),n.xp6(1),n.Q6J("ngIf",null==(i=t.journalForm.get("description"))||null==i.errors?null:i.errors.maxlength)}}function _n(o,r){if(1&o){const t=n.EpF();n.ynx(0),n.TgZ(1,"form",3),n.NdJ("ngSubmit",function(){n.CHM(t);const i=n.oxw();return n.KtG(i.onSubmit())}),n.TgZ(2,"div",4)(3,"label",5),n._uU(4,"Nom"),n.qZA(),n._UZ(5,"input",6),n.YNc(6,cn,3,2,"div",7),n.qZA(),n.TgZ(7,"div",4)(8,"label",8),n._uU(9,"Description"),n.qZA(),n._UZ(10,"textarea",9),n.YNc(11,dn,3,2,"div",7),n.qZA(),n.TgZ(12,"div",4)(13,"label",10),n._uU(14,"Compte associ\xe9"),n.qZA(),n._UZ(15,"input",11),n.qZA(),n.TgZ(16,"div",4)(17,"button",12),n._uU(18,"Enregistrer"),n.qZA()()(),n.BQk()}if(2&o){const t=n.oxw();let e,i;n.xp6(1),n.Q6J("formGroup",t.journalForm),n.xp6(5),n.Q6J("ngIf",(null==(e=t.journalForm.get("name"))?null:e.invalid)&&(null==(e=t.journalForm.get("name"))?null:e.touched)),n.xp6(5),n.Q6J("ngIf",(null==(i=t.journalForm.get("description"))?null:i.invalid)&&(null==(i=t.journalForm.get("description"))?null:i.touched)),n.xp6(6),n.Q6J("disabled",t.journalForm.invalid)}}let I=(()=>{class o{constructor(t,e,i,a,s,u){this.journalsSession=t,this.journalsServ=e,this.route=i,this.router=a,this.fb=s,this.toastr=u,this.subs=[]}ngOnInit(){this.sessionify(),this.buildForm()}ngOnDestroy(){this.subs.forEach(t=>{t&&t.unsubscribe()})}sessionify(){const t=this.journalsSession.journal$.subscribe(e=>{this.journal=e,this.buildForm()});this.subs.push(t)}buildForm(){var t,e,i,a,s;this.journalForm=this.fb.group({name:[(null===(t=this.journal)||void 0===t?void 0:t.name)||"",[c.kI.required,c.kI.maxLength(30)]],description:[(null===(e=this.journal)||void 0===e?void 0:e.description)||(null===(i=this.journal)||void 0===i?void 0:i.name)||"",[c.kI.required,c.kI.maxLength(255)]],idAccount:[(null===(a=this.journal)||void 0===a?void 0:a.idAccount)||null,[]]});const u=this.journalForm.get("name"),m=null===(s=null==u?void 0:u.get("name"))||void 0===s?void 0:s.valueChanges.pipe((0,T.b)(500)).subscribe(f=>{const g=u.get("description");null!=g&&g.value||null==g||g.setValue(f)});m&&this.subs.push(m)}onSubmit(){const t=Object.assign(Object.assign({},this.journal),this.journalForm.value);if(null!=t&&t.journalId){const e=this.journalsServ.edit((null==t?void 0:t.journalId)||0,t).subscribe(i=>{this.journalsSession.loadJournal(i.journalId||0),this.toastr.success("Action effectu\xe9e avec succ\xe8s"),this.router.navigateByUrl(`/accounting/journals/${i.journalId}/details`)});this.subs.push(e)}else{const e=this.journalsServ.create(t).subscribe(i=>{this.journalsSession.loadJournal(i.journalId||0),this.toastr.success("Action effectu\xe9e avec succ\xe8s"),this.router.navigateByUrl(`/accounting/journals/${i.journalId}/details`)});this.subs.push(e)}}}return o.\u0275fac=function(t){return new(t||o)(n.Y36(p.l),n.Y36(d.yJ),n.Y36(_.gz),n.Y36(_.F0),n.Y36(c.qu),n.Y36(A._W))},o.\u0275cmp=n.Xpm({type:o,selectors:[["app-journal-edit"]],decls:6,vars:2,consts:[[4,"ngIf"],[1,"row"],[1,"col-md-6"],[3,"formGroup","ngSubmit"],[1,"form-group","mb-3"],["for","name",1,"form-label"],["type","text","id","name","formControlName","name",1,"form-control"],["class","text-danger",4,"ngIf"],["for","description",1,"form-label"],["id","description","formControlName","description",1,"form-control"],["for","idAccount",1,"form-label"],["type","text","id","idAccount","formControlName","idAccount",1,"form-control"],["type","submit",1,"btn","btn-success",3,"disabled"],[1,"text-danger"]],template:function(t,e){1&t&&(n.TgZ(0,"h1"),n._uU(1," Edition du journal "),n.YNc(2,rn,2,1,"ng-container",0),n.qZA(),n.TgZ(3,"div",1)(4,"div",2),n.YNc(5,_n,19,4,"ng-container",0),n.qZA()()),2&t&&(n.xp6(2),n.Q6J("ngIf",e.journal),n.xp6(3),n.Q6J("ngIf",e.journalForm))},dependencies:[h.O5,c._Y,c.Fj,c.JJ,c.JL,c.sg,c.u]}),o})(),pn=(()=>{class o{constructor(t){this.journalsSession=t,this.subs=[]}ngOnInit(){this.journalsSession.unloadJournal()}ngOnDestroy(){this.subs.forEach(t=>{t&&t.unsubscribe()})}}return o.\u0275fac=function(t){return new(t||o)(n.Y36(p.l))},o.\u0275cmp=n.Xpm({type:o,selectors:[["app-journal-create"]],decls:1,vars:0,template:function(t,e){1&t&&n._UZ(0,"app-journal-edit")},dependencies:[I]}),o})();function mn(o,r){1&o&&(n.ynx(0),n.TgZ(1,"div",1)(2,"em"),n._uU(3,"Aucun journal..."),n.qZA()(),n.BQk())}function gn(o,r){if(1&o){const t=n.EpF();n.ynx(0),n.TgZ(1,"div",2),n._uU(2,"Voulez-vous vraiment supprimer ce journal?"),n.qZA(),n.TgZ(3,"dl",3)(4,"dt",4),n._uU(5,"D\xe9signation"),n.qZA(),n.TgZ(6,"dd",5),n._uU(7),n.qZA(),n.TgZ(8,"dt",4),n._uU(9,"Description"),n.qZA(),n.TgZ(10,"dd",5),n._uU(11),n.qZA(),n._UZ(12,"dt",4),n.TgZ(13,"dd",5)(14,"button",6),n.NdJ("click",function(){n.CHM(t);const i=n.oxw();return n.KtG(i.deleteJournal())}),n._uU(15," Supprimer "),n.qZA()()(),n._UZ(16,"hr"),n.TgZ(17,"div",7)(18,"a",8),n._UZ(19,"i",9),n._uU(20," Retour aux journaux "),n.qZA()(),n.BQk()}if(2&o){const t=n.oxw();n.xp6(7),n.Oqu(t.journal.name),n.xp6(4),n.Oqu(t.journal.description)}}let hn=(()=>{class o{constructor(t,e,i,a,s){this.journalsServ=t,this.journalsSession=e,this.route=i,this.router=a,this.toastr=s,this.subs=[]}ngOnInit(){this.sessionify()}ngOnDestroy(){this.subs.forEach(t=>{t&&t.unsubscribe()})}sessionify(){const t=this.journalsSession.journal$.subscribe(e=>{this.journal=e});this.subs.push(t)}deleteJournal(){if(this.journal){const t=this.journalsServ.delete(this.journal.journalId||0).subscribe(e=>{this.toastr.success("Journal supprim\xe9 avec succ\xe8s"),this.router.navigateByUrl("/accounting/journals")});this.subs.push(t)}}}return o.\u0275fac=function(t){return new(t||o)(n.Y36(d.yJ),n.Y36(p.l),n.Y36(_.gz),n.Y36(_.F0),n.Y36(A._W))},o.\u0275cmp=n.Xpm({type:o,selectors:[["app-journal-delete"]],decls:2,vars:2,consts:[[4,"ngIf"],[1,"alert","alert-warning"],[1,"alert","alert-danger"],[1,"row"],[1,"col-md-4"],[1,"col-md-8"],["type","button",1,"btn","btn-danger","mt-3",3,"click"],[1,"text-center"],["routerLink","/accounting/journals",1,"btn","btn-sm","btn-light","border"],[1,"fa","fa-arrow-left"]],template:function(t,e){1&t&&(n.YNc(0,mn,4,0,"ng-container",0),n.YNc(1,gn,21,2,"ng-container",0)),2&t&&(n.Q6J("ngIf",!e.journal),n.xp6(1),n.Q6J("ngIf",e.journal))},dependencies:[h.O5,_.yS]}),o})();function fn(o,r){1&o&&(n.ynx(0),n.TgZ(1,"div",1)(2,"em"),n._uU(3,"Aucun journal..."),n.qZA()(),n.BQk())}function vn(o,r){if(1&o&&(n.ynx(0),n.TgZ(1,"h1"),n._uU(2),n.qZA(),n.TgZ(3,"div",2),n._uU(4),n.qZA(),n._UZ(5,"hr"),n.TgZ(6,"div",3)(7,"a",4),n._UZ(8,"i",5),n._uU(9," Retour aux journaux "),n.qZA()(),n.BQk()),2&o){const t=n.oxw();n.xp6(2),n.Oqu(t.journal.name),n.xp6(2),n.hij(" ",t.journal.description," ")}}let xn=(()=>{class o{constructor(t,e){this.journalsSession=t,this.route=e,this.subs=[]}ngOnInit(){this.sessionify()}ngOnDestroy(){this.subs.forEach(t=>{t&&t.unsubscribe()})}sessionify(){const t=this.journalsSession.journal$.subscribe(e=>{this.journal=e});this.subs.push(t)}}return o.\u0275fac=function(t){return new(t||o)(n.Y36(p.l),n.Y36(_.gz))},o.\u0275cmp=n.Xpm({type:o,selectors:[["app-journal-overview"]],decls:2,vars:2,consts:[[4,"ngIf"],[1,"alert","alert-warning"],[1,"alert","alert-secondary"],[1,"text-center"],["routerLink","/accounting/journals",1,"btn","btn-sm","btn-light","border"],[1,"fa","fa-arrow-left"]],template:function(t,e){1&t&&(n.YNc(0,fn,4,0,"ng-container",0),n.YNc(1,vn,10,2,"ng-container",0)),2&t&&(n.Q6J("ngIf",!e.journal),n.xp6(1),n.Q6J("ngIf",e.journal))},dependencies:[h.O5,_.yS]}),o})();var L=l(5439),F=l(1884),E=l(3900),bn=l(7501),Q=l(2826),j=l(1230),Zn=l(6065),Tn=l(6152);function Cn(o,r){if(1&o){const t=n.EpF();n.ynx(0),n.TgZ(1,"button",39),n.NdJ("click",function(){n.CHM(t);const i=n.oxw().$implicit,a=n.oxw(3);return n.KtG(a.onAccountChange(i))}),n._UZ(2,"i",40),n.qZA(),n.BQk()}}function Jn(o,r){1&o&&(n.TgZ(0,"div",41),n._uU(1," Le compte est requis. "),n.qZA())}function An(o,r){1&o&&(n.TgZ(0,"div",41),n._uU(1," Ce montant est invalide. "),n.qZA())}function jn(o,r){1&o&&(n.TgZ(0,"div",41),n._uU(1," Ce montant est invalide. "),n.qZA())}function yn(o,r){if(1&o&&(n.ynx(0),n.TgZ(1,"option",42),n._uU(2),n.qZA(),n.BQk()),2&o){const t=r.$implicit;n.xp6(1),n.s9C("value",t.currencyId),n.xp6(1),n.Oqu(t.code)}}function qn(o,r){1&o&&(n.TgZ(0,"div",41),n._uU(1," La devise est requise. "),n.qZA())}function Un(o,r){1&o&&(n.TgZ(0,"div",41),n._uU(1," Le taux est requis. "),n.qZA())}function In(o,r){if(1&o&&(n.ynx(0),n.TgZ(1,"option",42),n._uU(2),n.qZA(),n.BQk()),2&o){const t=r.$implicit;n.xp6(1),n.s9C("value",t.centerId),n.xp6(1),n.Oqu(t.name)}}function Ln(o,r){1&o&&(n.TgZ(0,"div",41),n._uU(1," Le centre est requis. "),n.qZA())}const Z=function(o){return{"is-invalid":o}};function Fn(o,r){if(1&o){const t=n.EpF();n.ynx(0),n.TgZ(1,"tr",25)(2,"td"),n._UZ(3,"input",26),n.ALo(4,"toFormControl"),n.ALo(5,"toFormControl"),n.TgZ(6,"div",27)(7,"input",28),n.NdJ("selectItem",function(i){const s=n.CHM(t).$implicit,u=n.oxw(3);return n.KtG(u.onAccountSelect(i,s))}),n.ALo(8,"toFormControl"),n.ALo(9,"toFormControl"),n.qZA(),n.YNc(10,Cn,3,0,"ng-container",0),n.qZA(),n.YNc(11,Jn,2,0,"div",29),n.ALo(12,"toFormControl"),n.ALo(13,"toFormControl"),n.qZA(),n.TgZ(14,"td"),n._UZ(15,"input",30),n.ALo(16,"toFormControl"),n.ALo(17,"toFormControl"),n.YNc(18,An,2,0,"div",29),n.ALo(19,"toFormControl"),n.ALo(20,"toFormControl"),n.qZA(),n.TgZ(21,"td"),n._UZ(22,"input",31),n.ALo(23,"toFormControl"),n.ALo(24,"toFormControl"),n.YNc(25,jn,2,0,"div",29),n.ALo(26,"toFormControl"),n.ALo(27,"toFormControl"),n.qZA(),n.TgZ(28,"td")(29,"select",32),n.ALo(30,"toFormControl"),n.ALo(31,"toFormControl"),n.YNc(32,yn,3,2,"ng-container",24),n.qZA(),n.YNc(33,qn,2,0,"div",29),n.ALo(34,"toFormControl"),n.ALo(35,"toFormControl"),n.qZA(),n.TgZ(36,"td",14),n._UZ(37,"input",33),n.ALo(38,"toFormControl"),n.ALo(39,"toFormControl"),n.YNc(40,Un,2,0,"div",29),n.ALo(41,"toFormControl"),n.ALo(42,"toFormControl"),n.qZA(),n.TgZ(43,"td",34)(44,"select",35),n.ALo(45,"toFormControl"),n.ALo(46,"toFormControl"),n.YNc(47,In,3,2,"ng-container",24),n.qZA(),n.YNc(48,Ln,2,0,"div",29),n.ALo(49,"toFormControl"),n.ALo(50,"toFormControl"),n.qZA(),n.TgZ(51,"td")(52,"div",36)(53,"button",16),n.NdJ("click",function(){n.CHM(t);const i=n.oxw(3);return n.KtG(i.addLine())}),n._UZ(54,"i",17),n.qZA(),n.TgZ(55,"button",37),n.NdJ("click",function(){const a=n.CHM(t).index,s=n.oxw(3);return n.KtG(s.removeLine(a))}),n._UZ(56,"i",38),n.qZA()()()(),n.BQk()}if(2&o){const t=r.$implicit,e=r.index,i=n.oxw(3);let a,s;n.xp6(1),n.Q6J("formGroupName",e),n.xp6(2),n.Q6J("ngClass",n.VKq(74,Z,n.lcZ(4,22,t.get("idAccount")).invalid&&n.lcZ(5,24,t.get("idAccount")).touched)),n.xp6(4),n.ekj("is-invalid",n.lcZ(8,26,t.get("idAccount")).invalid&&n.lcZ(9,28,t.get("idAccount")).touched),n.Q6J("ngbTypeahead",i.searchAccount)("resultFormatter",i.formatter)("inputFormatter",i.formatter)("readOnly",(null==(a=t.get("idAccount"))?null:a.value)&&(null==(a=t.get("selectedAccount"))?null:a.value)),n.xp6(3),n.Q6J("ngIf",(null==(s=t.get("idAccount"))?null:s.value)&&(null==(s=t.get("selectedAccount"))?null:s.value)),n.xp6(1),n.Q6J("ngIf",n.lcZ(12,30,t.get("idAccount")).invalid&&n.lcZ(13,32,t.get("idAccount")).touched),n.xp6(4),n.Q6J("ngClass",n.VKq(76,Z,n.lcZ(16,34,t.get("debit")).invalid&&n.lcZ(17,36,t.get("debit")).touched)),n.xp6(3),n.Q6J("ngIf",n.lcZ(19,38,t.get("debit")).invalid&&n.lcZ(20,40,t.get("debit")).touched),n.xp6(4),n.Q6J("ngClass",n.VKq(78,Z,n.lcZ(23,42,t.get("credit")).invalid&&n.lcZ(24,44,t.get("credit")).touched)),n.xp6(3),n.Q6J("ngIf",n.lcZ(26,46,t.get("credit")).invalid&&n.lcZ(27,48,t.get("credit")).touched),n.xp6(4),n.Q6J("ngClass",n.VKq(80,Z,n.lcZ(30,50,t.get("idCurrency")).invalid&&n.lcZ(31,52,t.get("idCurrency")).touched)),n.xp6(3),n.Q6J("ngForOf",i.currencies),n.xp6(1),n.Q6J("ngIf",n.lcZ(34,54,t.get("idCurrency")).invalid&&n.lcZ(35,56,t.get("idCurrency")).touched),n.xp6(4),n.Q6J("ngClass",n.VKq(82,Z,n.lcZ(38,58,t.get("rateValue")).invalid&&n.lcZ(39,60,t.get("rateValue")).touched)),n.xp6(3),n.Q6J("ngIf",n.lcZ(41,62,t.get("rateValue")).invalid&&n.lcZ(42,64,t.get("rateValue")).touched),n.xp6(4),n.Q6J("ngClass",n.VKq(84,Z,n.lcZ(45,66,t.get("idCenter")).invalid&&n.lcZ(46,68,t.get("idCenter")).touched)),n.xp6(3),n.Q6J("ngForOf",i.centers),n.xp6(1),n.Q6J("ngIf",n.lcZ(49,70,t.get("idCenter")).invalid&&n.lcZ(50,72,t.get("idCenter")).touched)}}function En(o,r){if(1&o&&(n.TgZ(0,"tbody",23),n.YNc(1,Fn,57,86,"ng-container",24),n.ALo(2,"formArray"),n.qZA()),2&o){const t=n.oxw(2);n.xp6(1),n.Q6J("ngForOf",n.lcZ(2,1,t.transactionForm.controls.transactionLines).controls)}}function Qn(o,r){1&o&&(n.TgZ(0,"div",43),n._uU(1," Le total des d\xe9bits doit \xeatre \xe9gal au total des cr\xe9dits. "),n.qZA())}function kn(o,r){if(1&o){const t=n.EpF();n.ynx(0),n.TgZ(1,"h5",1),n._uU(2),n.qZA(),n.TgZ(3,"form",2),n.NdJ("ngSubmit",function(){n.CHM(t);const i=n.oxw();return n.KtG(i.saveTransaction())}),n.TgZ(4,"div",3)(5,"div",4)(6,"label",5),n._uU(7,"R\xe9f\xe9rence"),n.qZA(),n._UZ(8,"input",6),n.qZA(),n.TgZ(9,"div",7)(10,"label",8),n._uU(11,"Description"),n.qZA(),n._UZ(12,"input",9),n.qZA(),n.TgZ(13,"div",4)(14,"label",10),n._uU(15,"Date"),n.qZA(),n._UZ(16,"input",11),n.qZA()(),n.TgZ(17,"h5",12),n._uU(18,"Ecritures"),n.qZA(),n.TgZ(19,"table",13)(20,"thead")(21,"tr")(22,"th"),n._uU(23,"Compte"),n.qZA(),n.TgZ(24,"th"),n._uU(25,"D\xe9bit"),n.qZA(),n.TgZ(26,"th"),n._uU(27,"Cr\xe9dit"),n.qZA(),n.TgZ(28,"th"),n._uU(29,"Devise"),n.qZA(),n.TgZ(30,"th",14),n._uU(31,"Taux"),n.qZA(),n.TgZ(32,"th",15),n._uU(33,"Centre"),n.qZA(),n.TgZ(34,"th")(35,"button",16),n.NdJ("click",function(){n.CHM(t);const i=n.oxw();return n.KtG(i.addLine())}),n._UZ(36,"i",17),n.qZA()()()(),n.YNc(37,En,3,3,"tbody",18),n.TgZ(38,"tfoot")(39,"tr")(40,"td",19),n._uU(41,"Total"),n.qZA(),n.TgZ(42,"td",20),n._uU(43),n.qZA(),n._UZ(44,"td"),n.TgZ(45,"td",20),n._uU(46),n.qZA(),n.TgZ(47,"td")(48,"button",21),n._uU(49,"Enregistrer"),n.qZA()(),n._UZ(50,"td"),n.qZA()()(),n.YNc(51,Qn,2,0,"div",22),n._UZ(52,"br"),n.TgZ(53,"button",21),n._uU(54,"Enregistrer"),n.qZA()(),n.BQk()}if(2&o){const t=n.oxw();n.xp6(2),n.hij("Saisie au journal ",null==t.journal?null:t.journal.name,""),n.xp6(1),n.Q6J("formGroup",t.transactionForm),n.xp6(34),n.Q6J("ngIf",t.transactionForm.controls.transactionLines),n.xp6(6),n.Oqu(t.computeDebitCredit()[0]),n.xp6(3),n.Oqu(t.computeDebitCredit()[1]),n.xp6(2),n.Q6J("disabled",t.transactionForm.invalid),n.xp6(3),n.Q6J("ngIf",t.transactionForm.controls.transactionLines.invalid&&t.transactionForm.controls.transactionLines.touched),n.xp6(2),n.Q6J("disabled",t.transactionForm.invalid)}}let k=(()=>{class o{constructor(t,e,i,a,s,u,m,f,g,v,y){this.accoutingSession=t,this.journalsSession=e,this.transactionServ=i,this.currenciesServ=a,this.centersService=s,this.accountsService=u,this.ratesServ=m,this.fb=f,this.router=g,this.toastr=v,this.modalService=y,this.onEdited=new n.vpe,this.currencies=[],this.centers=[],this.subs=[],this.transactionLinesBalanceValidator=x=>{if(x){const C=this.computeDebitCredit();return C[0]===C[1]?null:{transactionLinesNotBalanced:!0}}return null},this.searchAccount=x=>x.pipe((0,T.b)(200),(0,F.x)(),(0,E.w)(C=>C.length<=0?[]:this.accountsService.index(void 0,!0,C,0,10))),this.formatter=x=>x?`${x.accountId} ${x.name}`:""}ngOnInit(){this.sessionify(),this.loadCurrencies(),this.loadCenters(),this.buildForm()}ngOnDestroy(){this.subs.forEach(t=>{t&&t.unsubscribe()})}sessionify(){const t=this.accoutingSession.currency$.subscribe(i=>{this.sessionCurrency=i,this.buildForm()});this.subs.push(t);const e=this.journalsSession.journal$.subscribe(i=>{this.journal=i,this.buildForm()});this.subs.push(e)}loadCenters(){this.centersService.index("",0,10).subscribe(t=>{this.centers=t})}loadCurrencies(){this.currenciesServ.index(void 0,"",0,10).subscribe(t=>{this.currencies=t})}buildForm(){var t,e,i,a,s;const u=this.currentTransaction||new d.n$;u.transactionDate||(u.transactionDate=L(new Date)),u.idJournal||(u.idJournal=(null===(t=this.journal)||void 0===t?void 0:t.journalId)||0),!(null===(e=u.transactionLines)||void 0===e)&&e.length||(u.transactionLines=[]),this.transactionForm=this.fb.group({transactionId:[u.transactionId||null,[]],idJournal:[u.idJournal,[c.kI.required]],reference:[u.reference,[c.kI.maxLength(20)]],description:[u.description,[c.kI.required,c.kI.maxLength(255)]],transactionDate:[u.transactionDate,[c.kI.required]],transactionLines:this.fb.array([],[this.transactionLinesBalanceValidator])}),null===(i=u.transactionLines)||void 0===i||i.map(m=>this.addLine(m)),!(null===(a=u.transactionLines)||void 0===a)&&a.length||(this.addLine(),this.addLine()),null===(s=this.transactionForm.get("transactionDate"))||void 0===s||s.valueChanges.pipe((0,T.b)(1e3)).subscribe(m=>{this.transactionForm.get("transactionLines").controls.forEach(g=>{var v;null!==(v=g.get("idCurrency"))&&void 0!==v&&v.value&&this.updateRate(g)})})}createTransactionLine(t){var e;const i=this.transactionForm.get("transactionLines");if(i){const a=this.fb.group({transactionLineId:[t.transactionLineId||null,[]],idTransaction:[t.idTransaction||null,[]],idAccount:[t.idAccount||null,[c.kI.required]],selectedAccount:["",[c.kI.required]],idCurrency:[t.idCurrency||null,[c.kI.required]],idCenter:[t.idCenter||null,[c.kI.required]],debit:[t.debit||null,[c.kI.min(0)]],credit:[t.credit||null,[c.kI.min(0)]],rateValue:[t.rateValue||1,[c.kI.required,c.kI.min(0)]]});null===(e=a.get("idCurrency"))||void 0===e||e.valueChanges.pipe((0,T.b)(500)).subscribe(s=>{this.updateRate(a)}),i.push(a)}}updateRate(t){var e,i;const a=null===(e=this.transactionForm.get("transactionDate"))||void 0===e?void 0:e.value,s=null===(i=t.get("idCurrency"))||void 0===i?void 0:i.value,u=t.get("rateValue");this.loadRate(s,L(a),u)}loadRate(t,e,i){var a;e&&t?this.ratesServ.find(t,null===(a=this.sessionCurrency)||void 0===a?void 0:a.currencyId,e).subscribe(s=>{var u;null==i||i.setValue(null!==(u=s.rateValue)&&void 0!==u?u:1)},s=>{this.onRateUnfound(e,t,i)}):this.onRateUnfound(e,t,i)}onRateUnfound(t,e,i){null==i||i.setValue(0),this.openRateDialog(t,e,i)}openRateDialog(t,e,i){const a=this.modalService.open(bn.H,{size:"xl",backdrop:"static"}),s=new d.KH;s.day=t,s.idTargetCurrency=e,a.componentInstance.rate=s,a.result.then(u=>{this.loadRate(e,t,i)}).catch(u=>{this.toastr.error("Attention! Edition du taux de change annul\xe9. Ceci peut causer un disfonctionnement")})}addLine(t){var e,i;if(!t){t=new d.Ln;const a=this.computeDebitCredit();t.init({debit:a[0]>a[1]?null:a[1]-a[0],credit:a[1]>a[0]?null:a[0]-a[1],idCurrency:null!==(i=null===(e=this.currencies)||void 0===e?void 0:e.length)&&void 0!==i?i:this.currencies[0].currencyId})}this.createTransactionLine(t)}removeLine(t){this.transactionForm.get("transactionLines").removeAt(t)}computeDebitCredit(){var t;let e=0,i=0,a=null===(t=this.transactionForm)||void 0===t?void 0:t.get("lines");return a&&a.controls.forEach(s=>{var u,m,f,g;if(s){let v=(null===(u=s.get("debit"))||void 0===u?void 0:u.value)||0*(null===(m=s.get("rateValue"))||void 0===m?void 0:m.value),y=((null===(f=s.get("credit"))||void 0===f?void 0:f.value)||0)*(null===(g=s.get("rateValue"))||void 0===g?void 0:g.value);e+=v,i+=y}}),[e,i]}onAccountSelect(t,e){var i,a;const s=t.item;null===(i=e.get("idAccount"))||void 0===i||i.setValue(s.accountId),null===(a=e.get("selectedAccount"))||void 0===a||a.setValue(`${s.accountId} ${s.name}`)}onAccountChange(t){var e,i;null===(e=t.get("idAccount"))||void 0===e||e.setValue(""),null===(i=t.get("selectedAccount"))||void 0===i||i.setValue("")}saveTransaction(){if(console.log({transactionValue:this.transactionForm.value}),this.transactionForm.invalid)return void this.toastr.error("Donn\xe9es invalides. Veuillez corriger svp");const t=this.transactionForm.value,e=new d.n$;e.init(t),this.transactionServ.create(e).subscribe(i=>{this.onEdited.emit(i),this.toastr.success("Action effectu\xe9e avec succ\xe8ss"),this.currentTransaction=new d.n$,this.currentTransaction.init({transactionDate:i.transactionDate}),this.buildForm()})}}return o.\u0275fac=function(t){return new(t||o)(n.Y36(Q.e),n.Y36(p.l),n.Y36(d.Iv),n.Y36(d.sV),n.Y36(d.BL),n.Y36(d.H$),n.Y36(d.Cp),n.Y36(c.qu),n.Y36(_.F0),n.Y36(A._W),n.Y36(j.FF))},o.\u0275cmp=n.Xpm({type:o,selectors:[["app-journal-transactions"]],outputs:{onEdited:"onEdited"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"text-upper"],["novalidate","",3,"formGroup","ngSubmit"],[1,"row"],[1,"form-group","col-md-3"],["for","reference"],["type","text","id","reference","formControlName","reference",1,"form-control","form-control-sm"],[1,"form-group","col-md-6"],["for","description"],["type","text","id","description","formControlName","description",1,"form-control","form-control-sm"],["for","transactionDate"],["type","date","id","transactionDate","formControlName","transactionDate",1,"form-control","form-control-sm"],[1,"mt-2"],[1,"table","table-bordered","table-striped"],["title","Taux de change"],["title","Centre des frais"],["type","button","title","Ajouter une ligne",1,"btn","btn-sm","btn-outline-success",3,"click"],[1,"fa","fa-plus"],["formArrayName","transactionLines",4,"ngIf"],["colspan","2",1,"text-end"],[1,"text-end"],["type","submit",1,"btn","btn-sm","btn-success",3,"disabled"],["class","text-danger",4,"ngIf"],["formArrayName","transactionLines"],[4,"ngFor","ngForOf"],[3,"formGroupName"],["formControlName","idAccount","type","hidden",1,"form-control","form-control-sm",3,"ngClass"],[1,"input-group"],["type","text","formControlName","selectedAccount",1,"form-control","form-control-sm",3,"ngbTypeahead","resultFormatter","inputFormatter","readOnly","selectItem"],["class","invalid-feedback",4,"ngIf"],["formControlName","debit","type","number",1,"form-control","form-control-sm",3,"ngClass"],["formControlName","credit","type","number",1,"form-control","form-control-sm",3,"ngClass"],["formControlName","idCurrency",1,"form-control","form-control-sm",3,"ngClass"],["formControlName","rateValue","type","number",1,"form-control","form-control-sm",3,"ngClass"],["title","centre des frais"],["formControlName","idCenter","type","number",1,"form-control","form-control-sm",3,"ngClass"],[1,"btn-group"],["type","button",1,"btn","btn-sm","btn-danger",3,"click"],[1,"fa","fa-trash"],["type","button",1,"btn","btn-sm","btn-light","input-append",3,"click"],[1,"fa","fa-edit"],[1,"invalid-feedback"],[3,"value"],[1,"text-danger"]],template:function(t,e){1&t&&n.YNc(0,kn,55,8,"ng-container",0),2&t&&n.Q6J("ngIf",e.transactionForm)},dependencies:[h.mk,h.sg,h.O5,c._Y,c.YN,c.Kr,c.Fj,c.wV,c.EJ,c.JJ,c.JL,c.sg,c.u,c.x0,c.CE,j.dR,Zn.K,Tn.h]}),o})();var Sn=l(7418),Nn=l(7579),wn=l(9356);function Yn(o,r){if(1&o&&(n.ynx(0),n.TgZ(1,"option",19),n._uU(2),n.qZA(),n.BQk()),2&o){const t=r.$implicit;n.xp6(1),n.Q6J("value",t.subPeriodId),n.xp6(1),n.Oqu(t.name)}}const S=function(){return[]};function On(o,r){if(1&o){const t=n.EpF();n.ynx(0),n.TgZ(1,"select",17),n.NdJ("change",function(i){n.CHM(t);const a=n.oxw();return n.KtG(a.onPeriodChange(i))})("ngModelChange",function(i){n.CHM(t);const a=n.oxw();return n.KtG(a.subPeriodId=i)}),n.TgZ(2,"option",18),n._uU(3,"-Toutes les p\xe9riodes-"),n.qZA(),n.YNc(4,Yn,3,2,"ng-container",14),n.qZA(),n.BQk()}if(2&o){const t=n.oxw();n.xp6(1),n.Q6J("ngModel",t.subPeriodId),n.xp6(3),n.Q6J("ngForOf",(null==t.currentPeriod?null:t.currentPeriod.subPeriods)||n.DdM(2,S))}}function Dn(o,r){if(1&o&&(n.ynx(0),n.TgZ(1,"a",20),n._UZ(2,"i",12),n._uU(3," Ajouter "),n.qZA(),n.BQk()),2&o){const t=n.oxw();n.xp6(1),n.MGl("routerLink","/accounting/journals/",t.journal.journalId,"/transaction-edit")}}function Mn(o,r){1&o&&(n.ynx(0),n.TgZ(1,"div",21)(2,"em"),n._uU(3,"En cours..."),n.qZA()(),n.BQk())}function Bn(o,r){if(1&o&&(n.ynx(0),n._uU(1),n.ALo(2,"number"),n.TgZ(3,"span"),n._uU(4),n.qZA(),n.BQk()),2&o){const t=n.oxw().$implicit,e=n.oxw(2);n.xp6(1),n.hij(" ",n.xi3(2,2,t.debit,e.settings.numberFormat)," "),n.xp6(3),n.Oqu(null==t.currency?null:t.currency.code)}}function Vn(o,r){if(1&o&&(n.ynx(0),n._uU(1),n.ALo(2,"number"),n.TgZ(3,"span"),n._uU(4),n.qZA(),n.BQk()),2&o){const t=n.oxw().$implicit,e=n.oxw(2);n.xp6(1),n.hij(" ",n.xi3(2,2,t.credit,e.settings.numberFormat)," "),n.xp6(3),n.Oqu(null==t.currency?null:t.currency.code)}}function Kn(o,r){if(1&o&&(n.ynx(0),n._uU(1),n.ALo(2,"number"),n.BQk()),2&o){const t=n.oxw(2).$implicit,e=n.oxw(2);n.xp6(1),n.hij(" (",n.xi3(2,1,-1*t.amount,e.settings.numberFormat),") ")}}function $n(o,r){if(1&o&&(n.ynx(0),n._uU(1),n.ALo(2,"number"),n.BQk()),2&o){const t=n.oxw(2).$implicit,e=n.oxw(2);n.xp6(1),n.hij(" ",n.xi3(2,1,t.amount,e.settings.numberFormat)," ")}}function Pn(o,r){if(1&o&&(n.ynx(0),n.YNc(1,Kn,3,4,"ng-container",5),n.YNc(2,$n,3,4,"ng-container",5),n.BQk()),2&o){const t=n.oxw().$implicit;n.xp6(1),n.Q6J("ngIf",t.amount<0),n.xp6(1),n.Q6J("ngIf",t.amount>0)}}function Gn(o,r){if(1&o&&(n.TgZ(0,"tr")(1,"td"),n._uU(2),n.qZA(),n.TgZ(3,"td",23),n._uU(4),n.qZA(),n.TgZ(5,"td",24),n.YNc(6,Bn,5,5,"ng-container",5),n.qZA(),n.TgZ(7,"td",24),n.YNc(8,Vn,5,5,"ng-container",5),n.qZA(),n.TgZ(9,"td",25),n._uU(10),n.ALo(11,"number"),n.qZA(),n.TgZ(12,"td",24),n.YNc(13,Pn,3,2,"ng-container",5),n.qZA(),n._UZ(14,"td"),n.qZA()),2&o){const t=r.$implicit,e=n.oxw(2);n.xp6(2),n.Oqu(t.idAccount),n.xp6(2),n.Oqu(null==t.account?null:t.account.name),n.xp6(2),n.Q6J("ngIf",t.debit),n.xp6(2),n.Q6J("ngIf",t.credit),n.xp6(2),n.Oqu(n.xi3(11,6,t.rateValue,e.settings.numberFormat)),n.xp6(3),n.Q6J("ngIf",t.amount)}}function Rn(o,r){if(1&o&&(n.ynx(0),n.TgZ(1,"tr")(2,"td"),n._uU(3),n.qZA(),n.TgZ(4,"td",22)(5,"strong"),n._uU(6),n.ALo(7,"momentDate"),n.qZA()(),n._UZ(8,"td"),n.qZA(),n.YNc(9,Gn,15,9,"tr",14),n.BQk()),2&o){const t=r.$implicit,e=r.index,i=n.oxw();n.xp6(2),n.uIk("rowSpan",(t.transactionLines||n.DdM(8,S)).length+1),n.xp6(1),n.Oqu(e+1),n.xp6(3),n.AsE("",n.xi3(7,5,t.transactionDate,i.settings.momentDateFormat),": ",t.description,""),n.xp6(3),n.Q6J("ngForOf",t.transactionLines)}}function Hn(o,r){if(1&o&&(n.TgZ(0,"tr"),n._UZ(1,"th")(2,"th",9),n.TgZ(3,"th",10),n._uU(4),n.ALo(5,"number"),n.qZA(),n.TgZ(6,"th",10),n._uU(7),n.ALo(8,"number"),n.qZA(),n._UZ(9,"th",10)(10,"th",10)(11,"th"),n.qZA()),2&o){const t=r.$implicit,e=n.oxw(2);n.xp6(4),n.AsE("(",t.currencyCode,") ",n.xi3(5,4,t.totalDebit,e.settings.numberFormat),""),n.xp6(3),n.AsE("(",t.currencyCode,") ",n.xi3(8,7,t.totalCredit,e.settings.numberFormat),"")}}function zn(o,r){if(1&o&&(n.ynx(0),n.TgZ(1,"tfoot",26),n.YNc(2,Hn,12,10,"tr",14),n.qZA(),n.BQk()),2&o){const t=n.oxw();n.xp6(2),n.Q6J("ngForOf",t.totals)}}function Xn(o,r){if(1&o){const t=n.EpF();n.ynx(0),n.TgZ(1,"button",28),n.NdJ("click",function(){n.CHM(t);const i=n.oxw(2);return n.KtG(i.previous())}),n._UZ(2,"i",29),n._uU(3," Pr\xe9c\xe9dent "),n.qZA(),n.BQk()}}function Wn(o,r){if(1&o){const t=n.EpF();n.ynx(0),n.TgZ(1,"button",28),n.NdJ("click",function(){n.CHM(t);const i=n.oxw(2);return n.KtG(i.next())}),n._uU(2," Suivant "),n._UZ(3,"i",30),n.qZA(),n.BQk()}}function nt(o,r){if(1&o&&(n.ynx(0),n.TgZ(1,"div",15),n.YNc(2,Xn,4,0,"ng-container",5),n.TgZ(3,"span",27),n._uU(4),n.qZA(),n.YNc(5,Wn,4,0,"ng-container",5),n.qZA(),n.BQk()),2&o){const t=n.oxw();n.xp6(2),n.Q6J("ngIf",t.pageIndex>0),n.xp6(2),n.hij("Page ",t.pageIndex+1,""),n.xp6(1),n.Q6J("ngIf",t.hasNextPage)}}function tt(o,r){if(1&o){const t=n.EpF();n.TgZ(0,"div",31),n._UZ(1,"app-journal-transactions"),n.qZA(),n.TgZ(2,"div",32)(3,"button",33),n.NdJ("click",function(){const a=n.CHM(t).dismiss;return n.KtG(a("Cross click"))}),n._uU(4,"Terminer"),n.qZA()()}}const ot=[{path:"",redirectTo:"list",pathMatch:"full"},{path:"",component:J,children:[{path:"list",component:U},{path:"create",component:pn},{path:":id",component:en,children:[{path:"",redirectTo:"entries",pathMatch:"full"},{path:"details",redirectTo:"overview",pathMatch:"full"},{path:"overview",component:xn},{path:"entries",component:(()=>{class o{constructor(t,e,i,a){this.journalsSession=t,this.transactionServ=e,this.accountingServ=i,this.modalService=a,this.transactions=[],this.subPeriodId=void 0,this.pageIndex=0,this.pageSize=20,this.totalItems=20,this.hasNextPage=!1,this.totals=[],this.searchTerm="",this.searchTextChanged=new Nn.x,this.settings=Sn.X,this.loading=!1,this.subs=[]}ngOnInit(){this.sessionify(),this.handleSearch()}ngOnDestroy(){this.subs.forEach(t=>{t&&t.unsubscribe()})}sessionify(){const t=this.accountingServ.period$.subscribe(i=>{this.currentPeriod=i,this.loadTransactions()});this.subs.push(t);const e=this.journalsSession.journal$.subscribe(i=>{this.journal=i,this.loadTransactions()});this.subs.push(e)}calculateTotals(){const t={};this.transactions.forEach(i=>{var a;null===(a=i.transactionLines)||void 0===a||a.forEach(s=>{var u;const m=(null===(u=s.currency)||void 0===u?void 0:u.code)||s.idCurrency;t[m]||(t[m]={currencyCode:m,totalDebit:0,totalCredit:0});const g=(s.credit||0)*s.rateValue;t[m].totalDebit+=(s.debit||0)*s.rateValue,t[m].totalCredit+=g})});const e=Object.keys(t).map(i=>({currencyCode:t[i].currencyCode,totalDebit:t[i].totalDebit,totalCredit:t[i].totalCredit}));this.totals=e}loadTransactions(t){var e;this.loading=!0,this.transactionServ.index((null===(e=this.journal)||void 0===e?void 0:e.journalId)||void 0,this.subPeriodId,this.searchTerm,this.pageIndex,this.pageSize,"").subscribe(i=>{this.hasNextPage=i.length>0,this.loading=!1,t?(this.transactions=[...this.transactions,...i],this.hasNextPage&&this.next(!0)):this.transactions=i,this.calculateTotals()},i=>{this.loading=!1})}openTransactionEdit(t){this.transactionEditModal=this.modalService.open(t,{size:"xl"})}onTransactionEdited(t){const e=this.transactions.findIndex(i=>i.transactionId===t.transactionId);-1!==e?this.transactions[e]=t:this.transactions.push(t),this.transactionEditModal.close()}onPeriodChange(t){this.pageIndex=0,this.transactions=[],this.subPeriodId&&(this.pageSize=50),this.loadTransactions(!!this.subPeriodId)}onSearchChange(t){var e;this.pageIndex=0;const i=(null===(e=t.target)||void 0===e?void 0:e.value)||"";this.searchTerm=i,this.searchTextChanged.next(i)}handleSearch(){const t=this.searchTextChanged.pipe((0,T.b)(400),(0,F.x)(),(0,E.w)(e=>{var i;return this.pageIndex=0,this.transactionServ.index((null===(i=this.journal)||void 0===i?void 0:i.journalId)||void 0,this.subPeriodId,e,this.pageIndex,this.pageSize,"")})).subscribe(e=>{this.transactions=e,this.calculateTotals()});this.subs.push(t)}next(t){this.pageIndex++,this.loadTransactions(t)}previous(){this.pageIndex=Math.max(0,this.pageIndex-1),this.loadTransactions()}}return o.\u0275fac=function(t){return new(t||o)(n.Y36(p.l),n.Y36(d.Iv),n.Y36(Q.e),n.Y36(j.FF))},o.\u0275cmp=n.Xpm({type:o,selectors:[["app-journal-entries"]],decls:38,vars:7,consts:[[1,"container"],[1,"text-uppercase"],[1,"d-flex","justify-content-between","mb-3"],[1,"w-25"],["type","text","placeholder","Rechercher une op\xe9ration...",1,"form-control",3,"input"],[4,"ngIf"],[1,"table-responsive"],[1,"table","table-bordered","table-hover"],[1,"bg-light",2,"border-bottom","none"],["colspan","2"],[1,"text-end"],["type","button",1,"btn","btn-sm","btn-outline-success",3,"click"],[1,"fa","fa-plus"],[2,"border-top","none"],[4,"ngFor","ngForOf"],[1,"d-flex","justify-content-center","mt-3"],["transactionEdit",""],["placeholder","-Toutes les p\xe9riodes-",1,"form-control",3,"ngModel","change","ngModelChange"],["value",""],[3,"value"],["title","Ajouter une op\xe9ration",1,"btn","btn-sm","btn-success",3,"routerLink"],[1,"text-center"],["colspan","6",1,"text-center"],[2,"min-width","240px"],[1,"text-end",2,"min-width","80px"],[1,"text-end",2,"min-width","40px"],[1,"bg-light",2,"border-top","none"],[1,"btn","btn-sm","btn-info","me-1"],["type","button",1,"btn","btn-sm","btn-light","me-1",3,"click"],[1,"fa","fa-arrow-left"],[1,"fa","fa-arrow-right"],[1,"modal-body"],[1,"modal-footer"],["type","button","aria-label","Close",1,"btn","btn-light",3,"click"]],template:function(t,e){if(1&t){const i=n.EpF();n.TgZ(0,"div",0)(1,"h5",1),n._uU(2),n.qZA(),n._UZ(3,"hr"),n.TgZ(4,"div",2)(5,"div",3)(6,"input",4),n.NdJ("input",function(s){return e.onSearchChange(s)}),n.qZA()(),n.TgZ(7,"div",3),n.YNc(8,On,5,3,"ng-container",5),n.qZA(),n.YNc(9,Dn,4,1,"ng-container",5),n.qZA(),n.TgZ(10,"div",6),n.YNc(11,Mn,4,0,"ng-container",5),n.TgZ(12,"div",6)(13,"table",7)(14,"thead",8)(15,"tr")(16,"th"),n._uU(17,"#"),n.qZA(),n.TgZ(18,"th",9),n._uU(19,"Compte"),n.qZA(),n.TgZ(20,"th",10),n._uU(21,"D\xe9bit"),n.qZA(),n.TgZ(22,"th",10),n._uU(23,"Cr\xe9dit"),n.qZA(),n.TgZ(24,"th",10),n._uU(25,"Taux"),n.qZA(),n.TgZ(26,"th",10),n._uU(27,"Total"),n.qZA(),n.TgZ(28,"th")(29,"button",11),n.NdJ("click",function(){n.CHM(i);const s=n.MAs(37);return n.KtG(e.openTransactionEdit(s))}),n._UZ(30,"i",12),n.qZA()()()(),n.TgZ(31,"tbody",13),n.YNc(32,Rn,10,9,"ng-container",14),n.qZA(),n.YNc(33,zn,3,1,"ng-container",5),n.qZA()()(),n._UZ(34,"div",15),n.YNc(35,nt,6,3,"ng-container",5),n.qZA(),n.YNc(36,tt,5,0,"ng-template",null,16,n.W1O)}2&t&&(n.xp6(2),n.hij("Consultation du journal ",null==e.journal?null:e.journal.name,""),n.xp6(6),n.Q6J("ngIf",e.currentPeriod),n.xp6(1),n.Q6J("ngIf",e.journal),n.xp6(2),n.Q6J("ngIf",e.loading),n.xp6(21),n.Q6J("ngForOf",e.transactions),n.xp6(1),n.Q6J("ngIf",null==e.transactions?null:e.transactions.length),n.xp6(2),n.Q6J("ngIf",e.pageIndex>0||e.hasNextPage))},dependencies:[h.sg,h.O5,_.yS,c.YN,c.Kr,c.EJ,c.JJ,c.On,k,h.JJ,wn.v]}),o})()},{path:"transaction-edit",component:k},{path:"delete",component:hn},{path:"edit",component:I}]}]}];let et=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=n.oAB({type:o}),o.\u0275inj=n.cJS({imports:[_.Bz.forChild(ot),_.Bz]}),o})();var it=l(2611);let rt=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=n.oAB({type:o}),o.\u0275inj=n.cJS({imports:[h.ez,et,it.m]}),o})()},6065:(q,b,l)=>{l.d(b,{K:()=>_});var h=l(1223);let _=(()=>{class d{transform(p,...J){return p}}return d.\u0275fac=function(p){return new(p||d)},d.\u0275pipe=h.Yjl({name:"formArray",type:d,pure:!0}),d})()},6152:(q,b,l)=>{l.d(b,{h:()=>_});var h=l(1223);let _=(()=>{class d{transform(p,...J){return p}}return d.\u0275fac=function(p){return new(p||d)},d.\u0275pipe=h.Yjl({name:"toFormControl",type:d,pure:!0}),d})()}}]);