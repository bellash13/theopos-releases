"use strict";(self.webpackChunktheopos=self.webpackChunktheopos||[]).push([[613],{2613:(Z,l,u)=>{u.r(l),u.d(l,{ProductsModule:()=>R});var d=u(9808),p=u(6784),c=u(9150),m=u(7418),t=u(1223),a=u(2291),s=u(2382),_=u(2290),g=u(9356);function f(r,n){if(1&r&&(t.TgZ(0,"dl",1)(1,"dt",4),t._uU(2,"Produit"),t.qZA(),t.TgZ(3,"dd",4),t._uU(4),t.qZA(),t.TgZ(5,"dt",4),t._uU(6,"Quantit\xe9 achet\xe9e"),t.qZA(),t.TgZ(7,"dd",4),t._uU(8),t.qZA(),t.TgZ(9,"dt",4),t._uU(10,"Quantit\xe9 vendue"),t.qZA(),t.TgZ(11,"dd",4),t._uU(12),t.qZA(),t.TgZ(13,"dt",4),t._uU(14,"Quantit\xe9"),t.qZA(),t.TgZ(15,"dd",4),t._uU(16),t.qZA(),t.TgZ(17,"dt",4),t._uU(18,"Date"),t.qZA(),t.TgZ(19,"dd",4),t._uU(20),t.ALo(21,"momentDate"),t.qZA()()),2&r){const o=n.$implicit,e=t.oxw(2);t.xp6(4),t.Oqu(o.idProduct),t.xp6(4),t.Oqu(o.orderedQuantity),t.xp6(4),t.Oqu(o.soldQuantity),t.xp6(4),t.Oqu(o.quantity),t.xp6(4),t.Oqu(t.xi3(21,5,o.lastUpdate,e.settings.dateHourFullFormat))}}const h=function(r){return{"bg-danger text-white":r}};function x(r,n){if(1&r&&(t.TgZ(0,"tr",15),t._UZ(1,"td"),t.TgZ(2,"td",12),t._uU(3),t.qZA(),t.TgZ(4,"td",12),t._uU(5),t.qZA(),t.TgZ(6,"td",12),t._uU(7),t.qZA(),t.TgZ(8,"td",13),t._uU(9),t.ALo(10,"momentDate"),t.qZA(),t._UZ(11,"td"),t.qZA()),2&r){const o=n.$implicit,e=t.oxw(2);t.Q6J("ngClass",t.VKq(8,h,!(null!=o&&null!=o.delivery&&o.delivery.inOut))),t.xp6(3),t.Oqu(o.qtyPurchase),t.xp6(2),t.Oqu(o.qtyReceive),t.xp6(2),t.Oqu(o.qtyReceived),t.xp6(2),t.Oqu(t.xi3(10,5,null==o.delivery?null:o.delivery.receiptDate,e.settings.momentDateFormat))}}function T(r,n){if(1&r&&(t.ynx(0),t.TgZ(1,"div",1)(2,"div",2)(3,"div",3)(4,"dl",1)(5,"dt",4),t._uU(6,"Produit"),t.qZA(),t.TgZ(7,"dd",4),t._uU(8),t.qZA(),t.TgZ(9,"dt",4),t._uU(10,"Code & Description"),t.qZA(),t.TgZ(11,"dd",4),t._uU(12),t.qZA(),t.TgZ(13,"dt",4),t._uU(14,"Prix d'achat"),t.qZA(),t.TgZ(15,"dd",4),t._uU(16),t.qZA(),t.TgZ(17,"dt",4),t._uU(18,"Prix de vente"),t.qZA(),t.TgZ(19,"dd",4),t._uU(20),t.qZA()()()()(),t.TgZ(21,"div",5)(22,"div",2)(23,"div",3)(24,"h4"),t._uU(25,"STOCK"),t.qZA(),t.YNc(26,f,22,8,"dl",6),t.qZA()(),t.TgZ(27,"div",7)(28,"div",3)(29,"h6"),t._uU(30,"MOUVEMENTS"),t.qZA(),t.TgZ(31,"div",8)(32,"div",9),t._uU(33,"Mouvements sortants"),t.qZA(),t._UZ(34,"div",10),t.qZA(),t.TgZ(35,"table",11)(36,"tr"),t._UZ(37,"th"),t.TgZ(38,"th",12),t._uU(39,"Qt\xe9 achet\xe9e"),t.qZA(),t.TgZ(40,"th",12),t._uU(41,"Qt\xe9 \xe0 livrer"),t.qZA(),t.TgZ(42,"th",12),t._uU(43,"Qt\xe9 re\xe7ue"),t.qZA(),t.TgZ(44,"th",13),t._uU(45,"Date"),t.qZA(),t._UZ(46,"th"),t.qZA(),t.YNc(47,x,12,10,"tr",14),t.qZA()()()(),t.BQk()),2&r){const o=t.oxw();t.xp6(8),t.Oqu(o.currentProduct.name),t.xp6(4),t.AsE("",o.currentProduct.productId," ",o.currentProduct.description,""),t.xp6(4),t.Oqu(o.currentProduct.pricePurchase),t.xp6(4),t.Oqu(o.currentProduct.priceSell),t.xp6(6),t.Q6J("ngForOf",o.currentProduct.inventories),t.xp6(21),t.Q6J("ngForOf",o.currentProduct.deliveryLines)}}let b=(()=>{class r{constructor(o,e,i,v){this.route=o,this.productsApiServ=e,this.fb=i,this.toastr=v,this.settings=m.X}ngOnInit(){this.querify()}querify(){var o;null===(o=this.route.parent)||void 0===o||o.paramMap.subscribe(e=>{const i=e.get("id");i&&"0"!=i&&this.getProduct(i)})}getProduct(o){this.productsApiServ.details(o).subscribe(e=>{this.currentProduct=e})}}return r.\u0275fac=function(o){return new(o||r)(t.Y36(c.gz),t.Y36(a.b0),t.Y36(s.qu),t.Y36(_._W))},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-products-details"]],decls:3,vars:1,consts:[[4,"ngIf"],[1,"row"],[1,"col-md-4"],[1,"card","card-body"],[1,"col-md-6"],[1,"row","mt-2"],["class","row",4,"ngFor","ngForOf"],[1,"col-md-8"],[1,"row","mb-2"],[1,"col-md-11","text-end"],[1,"col-md-1","bg-danger","text-white"],[1,"table","table-borderless"],[1,"text-end","pe-2"],[1,"text-center"],["class","border-top",3,"ngClass",4,"ngFor","ngForOf"],[1,"border-top",3,"ngClass"]],template:function(o,e){1&o&&(t.TgZ(0,"h1"),t._uU(1,"DETAILS DU PRODUIT"),t.qZA(),t.YNc(2,T,48,7,"ng-container",0)),2&o&&(t.xp6(2),t.Q6J("ngIf",e.currentProduct))},dependencies:[d.mk,d.sg,d.O5,g.v]}),r})();var P=u(2277),A=u(6152);let C=(()=>{class r{transform(o,...e){return(null==o?void 0:o.errors)&&((null==o?void 0:o.touched)||(null==o?void 0:o.dirty))||!1}}return r.\u0275fac=function(o){return new(o||r)},r.\u0275pipe=t.Yjl({name:"validationFor",type:r,pure:!0}),r})();function U(r,n){if(1&r&&(t.ynx(0),t.TgZ(1,"div",4)(2,"a",5),t._uU(3,"Dernier produit"),t.qZA()(),t.BQk()),2&r){const o=t.oxw();t.xp6(2),t.MGl("routerLink","/products/",o.lastProductId,"/details")}}function q(r,n){1&r&&(t.TgZ(0,"div",22),t._uU(1," Valeur invalide "),t.qZA())}function F(r,n){1&r&&(t.TgZ(0,"div",22),t._uU(1," Valeur invalide "),t.qZA())}function I(r,n){1&r&&(t.TgZ(0,"div",22),t._uU(1," Valeur invalide "),t.qZA())}function y(r,n){1&r&&(t.TgZ(0,"div",22),t._uU(1," Valeur invalide "),t.qZA())}function E(r,n){1&r&&(t.TgZ(0,"div",22),t._uU(1," Valeur invalide "),t.qZA())}function L(r,n){1&r&&(t.TgZ(0,"div",22),t._uU(1," Valeur invalide "),t.qZA())}function M(r,n){if(1&r){const o=t.EpF();t.ynx(0),t.TgZ(1,"form",6)(2,"div",1)(3,"div",7)(4,"div",8)(5,"label",9),t._uU(6,"Code-barres"),t.qZA(),t.TgZ(7,"div"),t._UZ(8,"input",10),t.ALo(9,"toFormControl"),t.YNc(10,q,2,0,"div",11),t.ALo(11,"validationFor"),t.qZA()()(),t.TgZ(12,"div",12)(13,"div",8)(14,"label",13),t._uU(15,"Identifiant unique"),t.qZA(),t.TgZ(16,"div",12),t._UZ(17,"input",14),t.ALo(18,"toFormControl"),t.YNc(19,F,2,0,"div",11),t.ALo(20,"validationFor"),t.qZA()(),t.TgZ(21,"div",8)(22,"label",13),t._uU(23,"Nom"),t.qZA(),t.TgZ(24,"div",12),t._UZ(25,"input",15),t.ALo(26,"toFormControl"),t.YNc(27,I,2,0,"div",11),t.ALo(28,"validationFor"),t.qZA()(),t.TgZ(29,"div",8)(30,"label",13),t._uU(31,"Description"),t.qZA(),t.TgZ(32,"div",12),t._UZ(33,"input",16),t.ALo(34,"toFormControl"),t.YNc(35,y,2,0,"div",11),t.ALo(36,"validationFor"),t.qZA()(),t.TgZ(37,"div",8)(38,"label",13),t._uU(39,"Prix d'achat"),t.qZA(),t.TgZ(40,"div",12),t._UZ(41,"input",17),t.ALo(42,"toFormControl"),t.YNc(43,E,2,0,"div",11),t.ALo(44,"validationFor"),t.qZA()(),t.TgZ(45,"div",8)(46,"label",13),t._uU(47,"Prix de vente"),t.qZA(),t.TgZ(48,"div",12),t._UZ(49,"input",18),t.ALo(50,"toFormControl"),t.YNc(51,L,2,0,"div",11),t.ALo(52,"validationFor"),t.qZA()(),t.TgZ(53,"div",19),t._UZ(54,"div",7),t.TgZ(55,"div",12)(56,"button",20),t.NdJ("click",function(){t.CHM(o);const i=t.oxw();return t.KtG(i.save())}),t._UZ(57,"i",21),t._uU(58," Sauvegarder"),t.qZA()()()()()(),t.BQk()}if(2&r){const o=t.oxw();t.xp6(1),t.Q6J("formGroup",o.productForm),t.xp6(7),t.Q6J("formControl",t.lcZ(9,13,o.productForm.get("barCode"))),t.xp6(2),t.Q6J("ngIf",t.lcZ(11,15,o.productForm.get("barCode"))),t.xp6(7),t.Q6J("formControl",t.lcZ(18,17,o.productForm.get("productId"))),t.xp6(2),t.Q6J("ngIf",t.lcZ(20,19,o.productForm.get("productId"))),t.xp6(6),t.Q6J("formControl",t.lcZ(26,21,o.productForm.get("name"))),t.xp6(2),t.Q6J("ngIf",t.lcZ(28,23,o.productForm.get("name"))),t.xp6(6),t.Q6J("formControl",t.lcZ(34,25,o.productForm.get("description"))),t.xp6(2),t.Q6J("ngIf",t.lcZ(36,27,o.productForm.get("description"))),t.xp6(6),t.Q6J("formControl",t.lcZ(42,29,o.productForm.get("pricePurchase"))),t.xp6(2),t.Q6J("ngIf",t.lcZ(44,31,o.productForm.get("pricePurchase"))),t.xp6(6),t.Q6J("formControl",t.lcZ(50,33,o.productForm.get("priceSell"))),t.xp6(2),t.Q6J("ngIf",t.lcZ(52,35,o.productForm.get("priceSell")))}}let O=(()=>{class r{constructor(o,e,i,v){this.route=o,this.productsApiServ=e,this.fb=i,this.toastr=v,this.lastProductId="",this.priceIndex=1.3,this.viewMode="create"}ngOnInit(){this.querify(),this.buildForm()}querify(){var o;null===(o=this.route.parent)||void 0===o||o.paramMap.subscribe(e=>{const i=e.get("id");i&&"0"!=i?(this.getProduct(i),this.viewMode="edit"):this.viewMode="create"})}getProduct(o){this.productsApiServ.details(o).subscribe(e=>{this.currentProduct=e,this.buildForm()})}buildForm(){var o;this.currentProduct||(this.currentProduct=new a.dc),this.productForm=this.fb.group({barCode:[this.currentProduct.barCode,[]],name:[this.currentProduct.name,[s.kI.required]],description:[this.currentProduct.description,[s.kI.required]],pricePurchase:[this.currentProduct.pricePurchase,[]],priceSell:[this.currentProduct.priceSell,[]],productId:[this.currentProduct.productId,[s.kI.required]]}),null===(o=this.productForm.get("pricePurchase"))||void 0===o||o.valueChanges.subscribe(e=>{var i;const v=(e||0)*this.priceIndex;null===(i=this.productForm.get("priceSell"))||void 0===i||i.setValue(v)})}save(){if(this.productForm.invalid){const e=P.M.getFormGroupErrors(this.productForm).join("\n");return void this.toastr.error("Formulaire invalide.\n\n"+e)}const o=this.productForm.value;"create"===this.viewMode&&this.productsApiServ.create(o).subscribe(e=>{this.toastr.success("Produit sauvegard\xe9 avec succ\xe8s."),this.lastProductId=e.productId||"",this.currentProduct=null,this.buildForm()},e=>{this.toastr.error("Impossible de cr\xe9er ce produit.")}),"edit"===this.viewMode&&this.productsApiServ.edit(o.productId,o).subscribe(e=>{this.toastr.success("Produit sauvegard\xe9 avec succ\xe8s."),this.lastProductId=e.productId||"",this.currentProduct=null,this.buildForm()},e=>{this.toastr.error("Impossible de cr\xe9er ce produit.")})}}return r.\u0275fac=function(o){return new(o||r)(t.Y36(c.gz),t.Y36(a.b0),t.Y36(s.qu),t.Y36(_._W))},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-products-edit"]],decls:6,vars:2,consts:[[4,"ngIf"],[1,"row"],[1,"col-md-12"],[1,"mb-4","text-center"],[1,"text-end"],[3,"routerLink"],[3,"formGroup"],[1,"col-md-4"],[1,"form-group","mb-2","row"],["for","",1,"pt-2","mb-4"],["placeholder","Scanner code-barres du produit",1,"form-control",3,"formControl"],["class","text-danger",4,"ngIf"],[1,"col-md-8"],["for","",1,"col-md-4","text-end","pt-2"],["placeholder","Code du produit",1,"form-control",3,"formControl"],["placeholder","Nom du produit",1,"form-control",3,"formControl"],["placeholder","D\xe9crire le produit",1,"form-control",3,"formControl"],["type","number","step","0.0001","placeholder","Prix d'achat",1,"form-control",3,"formControl"],["type","number","step","0.0001","placeholder","Prix de vente",1,"form-control",3,"formControl"],[1,"form-group","row"],["type","button",1,"btn","btn-success",3,"click"],[1,"bx","bx-save"],[1,"text-danger"]],template:function(o,e){1&o&&(t.YNc(0,U,4,1,"ng-container",0),t.TgZ(1,"div",1)(2,"div",2)(3,"h4",3),t._uU(4,"EDITER PRODUIT"),t.qZA()()(),t.YNc(5,M,59,37,"ng-container",0)),2&o&&(t.Q6J("ngIf",e.lastProductId),t.xp6(5),t.Q6J("ngIf",e.productForm))},dependencies:[d.O5,c.yS,s._Y,s.Fj,s.wV,s.JJ,s.JL,s.oH,s.sg,A.h,C]}),r})();function Q(r,n){if(1&r){const o=t.EpF();t.TgZ(0,"button",9),t.NdJ("click",function(){t.CHM(o);const i=t.oxw(2);return t.KtG(i.navigateTo(i.productsIndex-1))}),t._UZ(1,"i",10),t._uU(2," Pr\xe9c\xe9dent "),t.qZA()}}function D(r,n){if(1&r){const o=t.EpF();t.TgZ(0,"button",9),t.NdJ("click",function(){t.CHM(o);const i=t.oxw(2);return t.KtG(i.navigateTo(i.productsIndex+1))}),t._uU(1," Suivant "),t._UZ(2,"i",11),t.qZA()}}function J(r,n){if(1&r&&(t.TgZ(0,"div",0)(1,"div",6),t.YNc(2,Q,3,0,"button",7),t.qZA(),t.TgZ(3,"div",8),t.YNc(4,D,3,0,"button",7),t.qZA()()),2&r){const o=t.oxw();t.xp6(2),t.Q6J("ngIf",o.productsIndex>0),t.xp6(2),t.Q6J("ngIf",o.products.length>=o.productsCount)}}function Y(r,n){1&r&&(t.ynx(0),t._UZ(1,"i",20),t.BQk())}function S(r,n){1&r&&(t.ynx(0),t._UZ(1,"i",21),t.BQk())}function w(r,n){if(1&r&&(t.TgZ(0,"div",12)(1,"div",13)(2,"div",14)(3,"h4",15),t._uU(4),t.qZA(),t.TgZ(5,"div"),t.YNc(6,Y,2,0,"ng-container",16),t.YNc(7,S,2,0,"ng-container",16),t.TgZ(8,"div")(9,"strong"),t._uU(10,"Code"),t.qZA(),t._uU(11),t.qZA()()(),t.TgZ(12,"div",17)(13,"a",18)(14,"small"),t._uU(15,"Afficher"),t.qZA()(),t.TgZ(16,"a",19)(17,"small"),t._uU(18,"Editer"),t.qZA()()()()()),2&r){const o=n.$implicit;t.xp6(4),t.Oqu(o.name),t.xp6(2),t.Q6J("ngIf",o.barCode),t.xp6(1),t.Q6J("ngIf",!o.barCode),t.xp6(4),t.hij(": ",o.productId,""),t.xp6(2),t.MGl("routerLink","/products/",o.productId,"/details"),t.xp6(3),t.MGl("routerLink","/products/",o.productId,"/edit")}}function N(r,n){if(1&r){const o=t.EpF();t.TgZ(0,"button",9),t.NdJ("click",function(){t.CHM(o);const i=t.oxw();return t.KtG(i.navigateTo(i.productsIndex-1))}),t._UZ(1,"i",10),t._uU(2," Pr\xe9c\xe9dent "),t.qZA()}}function k(r,n){if(1&r){const o=t.EpF();t.TgZ(0,"button",9),t.NdJ("click",function(){t.CHM(o);const i=t.oxw();return t.KtG(i.navigateTo(i.productsIndex+1))}),t._uU(1," Suivant "),t._UZ(2,"i",11),t.qZA()}}const G=[{path:"",redirectTo:"list",pathMatch:"full"},{path:"list",component:(()=>{class r{constructor(o,e){this.productsApiServ=o,this.route=e,this.products=[],this.productsIndex=0,this.productsCount=20}ngOnInit(){this.querify()}querify(){this.route.queryParams.subscribe(o=>{+o.n&&(this.productsCount=+o.n),this.navigateTo(+o.i?+o.i:0)})}navigateTo(o=0){this.productsIndex=o,this.getProducts()}getProducts(){this.productsApiServ.index("",this.productsIndex,this.productsCount).subscribe(o=>{this.products=o})}}return r.\u0275fac=function(o){return new(o||r)(t.Y36(a.b0),t.Y36(c.gz))},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-products-list"]],decls:15,vars:4,consts:[[1,"row"],[1,"col-md-12","text-end"],["routerLink","/products/0/edit","title","Cr\xe9er produit",1,"btn","btn-sm","btn-outline-success","mt-1","mb-2"],[1,"bx","bx-plus-circle"],["class","row",4,"ngIf"],["class","col-md-3 col-xs-6",4,"ngFor","ngForOf"],[1,"col"],["type","button","class","btn btn-sm btn-light",3,"click",4,"ngIf"],[1,"col","text-end"],["type","button",1,"btn","btn-sm","btn-light",3,"click"],[1,"bx","bx-left"],[1,"bx","bx-right"],[1,"col-md-3","col-xs-6"],[1,"card","text-center","mb-1","mt-1"],[1,"card-body"],[1,"card-text"],[4,"ngIf"],[1,"card-footer"],[1,"btn","btn-sm","btn-outline-info","pt-1","mt-2","mb-2",3,"routerLink"],[1,"btn","btn-sm","btn-outline-info","pt-1","mt-2","mb-2","ms-1",3,"routerLink"],[1,"bx","bx-barcode"],[1,"bx"]],template:function(o,e){1&o&&(t.TgZ(0,"h4"),t._uU(1,"CATALOGUE DES PRODUITS"),t.qZA(),t.TgZ(2,"div",0)(3,"div",1)(4,"a",2),t._UZ(5,"i",3),t._uU(6," Cr\xe9er produit"),t.qZA()()(),t.YNc(7,J,5,2,"div",4),t.TgZ(8,"div",0),t.YNc(9,w,19,6,"div",5),t.qZA(),t.TgZ(10,"div",0)(11,"div",6),t.YNc(12,N,3,0,"button",7),t.qZA(),t.TgZ(13,"div",8),t.YNc(14,k,3,0,"button",7),t.qZA()()),2&o&&(t.xp6(7),t.Q6J("ngIf",e.products.length>=e.productsCount),t.xp6(2),t.Q6J("ngForOf",e.products),t.xp6(3),t.Q6J("ngIf",e.productsIndex>0),t.xp6(2),t.Q6J("ngIf",e.products.length>=e.productsCount))},dependencies:[d.sg,d.O5,c.yS]}),r})()},{path:":id",component:(()=>{class r{constructor(){}ngOnInit(){}}return r.\u0275fac=function(o){return new(o||r)},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-products"]],decls:7,vars:0,consts:[[1,"text-end","mb-2"],["routerLink","/products/list","routerLinkActive","active"]],template:function(o,e){1&o&&(t.TgZ(0,"div",0)(1,"a",1),t._uU(2,"Tous les produits"),t.qZA()(),t._UZ(3,"router-outlet")(4,"hr"),t._uU(5,"\nPRODUIT\n"),t._UZ(6,"hr"))},dependencies:[c.lC,c.yS,c.Od]}),r})(),children:[{path:"edit",canActivate:[p.G],component:O},{path:"details",component:b}]}];let V=(()=>{class r{}return r.\u0275fac=function(o){return new(o||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[c.Bz.forChild(G),c.Bz]}),r})();var H=u(2611);let R=(()=>{class r{}return r.\u0275fac=function(o){return new(o||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[d.ez,V,H.m]}),r})()},9356:(Z,l,u)=>{u.d(l,{v:()=>p});var d=u(1223);let p=(()=>{class c{transform(t,a){return t?t.format(a):"-"}}return c.\u0275fac=function(t){return new(t||c)},c.\u0275pipe=d.Yjl({name:"momentDate",type:c,pure:!0}),c})()},6152:(Z,l,u)=>{u.d(l,{h:()=>p});var d=u(1223);let p=(()=>{class c{transform(t,...a){return t}}return c.\u0275fac=function(t){return new(t||c)},c.\u0275pipe=d.Yjl({name:"toFormControl",type:c,pure:!0}),c})()},7418:(Z,l,u)=>{u.d(l,{X:()=>d});const d={momentDateFormat:"DD/MM/yyyy",momentDateHourFormat:"DD/MM \xe0 HH:mm",dateFormat:"dd/MM/yyyy",dateHourFormat:"dd/MM hh:mm",dateHourFullFormat:"dd/MM/yyyy hh:mm",numberFormat:".2"}},2277:(Z,l,u)=>{u.d(l,{M:()=>d});const d={setFocus:function p(t,a=0){!t||setTimeout(()=>{t.nativeElement.focus()},a)},removeFocus:function c(t,a=0){!t||setTimeout(()=>{t.nativeElement.blur()},a)},getFormGroupErrors:function m(t){const a=[];return Object.keys(t.controls).forEach(s=>{var _;const g=null===(_=t.get(s))||void 0===_?void 0:_.errors;null!=g&&Object.keys(g).forEach(f=>{a.push(s+", "+f+": "+g[f])})}),a}}}}]);